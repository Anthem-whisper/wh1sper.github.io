<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='å‰è¨€ åœ¨è¥¿å·¥å¤§ä¸¾åŠçš„NPUCTF2020ä¸Šé¢åšåˆ°ä¸€é“webcryptoçš„é¢˜ï¼Œä»¥å‰ä»æ¥æ²¡æ¥è§¦è¿‡å¯†ç å®‰å…¨æ–¹å‘ï¼Œè¿™æ¬¡æ­£å¥½å­¦ä¸€ä¸‹å…¥ä¸ªé—¨
æ­£æ–‡ å‚è€ƒ
Padding Oracle Attackï¼š
ã€Šç™½å¸½å­è®²webå®‰å…¨ã€‹P239
&amp;raquo;ä¸€å¶é£˜é›¶å¸ˆå‚…
CBCç¿»è½¬æ”»å‡»ï¼š
&amp;raquo;æŸå¸ˆå‚…
&amp;raquo;æŸæŸå¸ˆå‚…
å…ˆæ¥è®²ä¸€è®²CBCæ¨¡å¼åŠ å¯†åŸç†ï¼š
 é¦–å…ˆå°†æ˜æ–‡ï¼ˆPlaintextï¼‰åˆ†ç»„(å¸¸è§çš„ä»¥16æˆ–8å­—èŠ‚ä¸ºä¸€ç»„)ï¼Œä½æ•°ä¸è¶³çš„ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦å¡«å……ã€‚ ç”Ÿæˆä¸€ä¸ªéšæœºçš„åˆå§‹åŒ–å‘é‡(IV)å’Œä¸€ä¸ªå¯†é’¥ã€‚ å°†IVå’Œç¬¬ä¸€ç»„æ˜æ–‡å¼‚æˆ–ï¼ˆxorè¿ç®—ï¼‰ã€‚ ç”¨å¯†é’¥å¯¹3ä¸­xoråäº§ç”Ÿçš„å¯†æ–‡åŠ å¯†ã€‚ ç”¨4ä¸­äº§ç”Ÿçš„å¯†æ–‡å¯¹ç¬¬äºŒç»„æ˜æ–‡è¿›è¡Œxoræ“ä½œã€‚ ç”¨å¯†é’¥å¯¹5ä¸­äº§ç”Ÿçš„å¯†æ–‡åŠ å¯†ã€‚ é‡å¤4-7ï¼Œåˆ°æœ€åä¸€ç»„æ˜æ–‡ã€‚ å°†IVå’ŒåŠ å¯†åçš„å¯†æ–‡æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå¾—åˆ°æœ€ç»ˆçš„å¯†æ–‡  è§£å¯†è¿‡ç¨‹ï¼š
 å…ˆä»å¯†æ–‡ä¸­å–å‡ºIVï¼Œç„¶åå¯¹å‰©ä¸‹çš„å¯†æ–‡åˆ†ç»„ï¼ˆ16æˆ–8å­—èŠ‚ä¸ºä¸€ç»„ï¼‰ ä½¿ç”¨ç§˜é’¥è§£å¯†ç¬¬ä¸€ç»„å¯†æ–‡ï¼Œå°†è§£å¯†ç»“æœä¸IVåšå¼‚æˆ–è¿ç®—ï¼Œå¾—åˆ°æ˜æ–‡1 ç„¶åä½¿ç”¨ç§˜é’¥è§£ç¬¬äºŒç»„å¯†æ–‡ï¼Œå°†è§£å¯†çš„ç»“æœä¸ä¸Šä¸€ç»„å¯†æ–‡è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œå¾—å‡ºæ˜æ–‡2 é‡å¤2-3ï¼Œç›´è‡³æ‰€æœ‰å¯†æ–‡è§£å¯†å®Œæ¯•  ä»¥ä¸Šå°±æ˜¯CBCæ¨¡å¼çš„åŠ å¯†è§£å¯†è¿‡ç¨‹ï¼Œæ¥ä¸‹æ¥è®²ä¸¤ç§æ‰‹æ®µï¼š
Padding Oracle Attack ç›´è¯‘ä¸º â€œå¡«å……Oracleæ”»å‡»â€ ï¼Œè¿™é‡Œä¸»è¦å…³æ³¨ä¸€ä¸‹è§£å¯†è¿‡ç¨‹ï¼š
å¯†æ–‡cipheré¦–å…ˆè¿›è¡Œä¸€ç³»åˆ—å¤„ç†ï¼Œå¦‚å›¾ä¸­çš„Block Cipher Decryption æˆ‘ä»¬å°†å¤„ç†åçš„å€¼ç§°ä¸º middle ä¸­é—´å€¼ ç„¶å middle ä¸æˆ‘ä»¬è¾“å…¥çš„ivè¿›è¡Œå¼‚æˆ–æ“ä½œ å¾—åˆ°çš„å³ä¸ºæ˜æ–‡ ä½†è¿™é‡Œæœ‰ä¸€ä¸ªè§„åˆ™å«åšPaddingå¡«å……ï¼š å› ä¸ºåŠ å¯†æ˜¯æŒ‰ç…§16ä½ä¸€ç»„åˆ†ç»„è¿›è¡Œçš„ è€Œå¦‚æœä¸è¶³16ä½ï¼Œå°±éœ€è¦è¿›è¡Œå¡«å……
æœ‰å‡ ä¸ªç©ºï¼Œå°±è¦å¡«å……å‡ ä¸ªâ€œå‡ â€
æ¯”å¦‚æ˜æ–‡ä¸ºadminï¼Œé‚£ä¹ˆéœ€è¦å¡«å……çš„å°±æ˜¯ admin\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b ï¼ˆ11ä¸ª\x0bï¼‰
å¦‚æœæˆ‘ä»¬è¾“å…¥ä¸€ä¸ªé”™è¯¯çš„ivï¼Œä¾æ—§æ˜¯å¯ä»¥è§£å¯†çš„ï¼Œä½†æ˜¯ middle å’Œæˆ‘ä»¬è¾“å…¥çš„ivç»è¿‡å¼‚æˆ–åå¾—åˆ°çš„å¡«å……å€¼å¯èƒ½å‡ºç°é”™è¯¯
æ¯”å¦‚æœ¬æ¥åº”è¯¥æ˜¯ admin\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b è€Œæˆ‘ä»¬é”™è¯¯çš„å¾—åˆ° admin\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x3b\x2c
è¿™æ ·è§£å¯†ç¨‹åºå¾€å¾€ä¼šæŠ›å‡ºå¼‚å¸¸(Padding Error)
åº”ç”¨åœ¨webé‡Œçš„æ—¶å€™ï¼Œå¾€å¾€æ˜¯302æˆ–æ˜¯500æŠ¥é”™ è€Œæ­£å¸¸è§£å¯†çš„æ—¶å€™æ˜¯200 æ‰€ä»¥è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æœåŠ¡å™¨çš„ååº”æ¥åˆ¤æ–­æˆ‘ä»¬è¾“å…¥çš„iv
çœ‹ä¾‹å­ï¼š
æˆ‘ä»¬å‡è®¾middleä¸­é—´å€¼ä¸ºï¼š
0x39 0x73 0x23 0x22 0x07 0x6a 0x26 0x3dæ­£ç¡®çš„è§£å¯†ivåº”è¯¥ä¸º'><title>Padding Oracle Attack&amp;CBCå­—èŠ‚ç¿»è½¬æ”»å‡»</title>

<link rel='canonical' href='https://anthem-whisper.github.io/p/padding-oracle-attackcbc%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/'>

<link rel="stylesheet" href="/scss/style.min.css"><meta property='og:title' content='Padding Oracle Attack&amp;CBCå­—èŠ‚ç¿»è½¬æ”»å‡»'>
<meta property='og:description' content='å‰è¨€ åœ¨è¥¿å·¥å¤§ä¸¾åŠçš„NPUCTF2020ä¸Šé¢åšåˆ°ä¸€é“webcryptoçš„é¢˜ï¼Œä»¥å‰ä»æ¥æ²¡æ¥è§¦è¿‡å¯†ç å®‰å…¨æ–¹å‘ï¼Œè¿™æ¬¡æ­£å¥½å­¦ä¸€ä¸‹å…¥ä¸ªé—¨
æ­£æ–‡ å‚è€ƒ
Padding Oracle Attackï¼š
ã€Šç™½å¸½å­è®²webå®‰å…¨ã€‹P239
&amp;raquo;ä¸€å¶é£˜é›¶å¸ˆå‚…
CBCç¿»è½¬æ”»å‡»ï¼š
&amp;raquo;æŸå¸ˆå‚…
&amp;raquo;æŸæŸå¸ˆå‚…
å…ˆæ¥è®²ä¸€è®²CBCæ¨¡å¼åŠ å¯†åŸç†ï¼š
 é¦–å…ˆå°†æ˜æ–‡ï¼ˆPlaintextï¼‰åˆ†ç»„(å¸¸è§çš„ä»¥16æˆ–8å­—èŠ‚ä¸ºä¸€ç»„)ï¼Œä½æ•°ä¸è¶³çš„ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦å¡«å……ã€‚ ç”Ÿæˆä¸€ä¸ªéšæœºçš„åˆå§‹åŒ–å‘é‡(IV)å’Œä¸€ä¸ªå¯†é’¥ã€‚ å°†IVå’Œç¬¬ä¸€ç»„æ˜æ–‡å¼‚æˆ–ï¼ˆxorè¿ç®—ï¼‰ã€‚ ç”¨å¯†é’¥å¯¹3ä¸­xoråäº§ç”Ÿçš„å¯†æ–‡åŠ å¯†ã€‚ ç”¨4ä¸­äº§ç”Ÿçš„å¯†æ–‡å¯¹ç¬¬äºŒç»„æ˜æ–‡è¿›è¡Œxoræ“ä½œã€‚ ç”¨å¯†é’¥å¯¹5ä¸­äº§ç”Ÿçš„å¯†æ–‡åŠ å¯†ã€‚ é‡å¤4-7ï¼Œåˆ°æœ€åä¸€ç»„æ˜æ–‡ã€‚ å°†IVå’ŒåŠ å¯†åçš„å¯†æ–‡æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå¾—åˆ°æœ€ç»ˆçš„å¯†æ–‡  è§£å¯†è¿‡ç¨‹ï¼š
 å…ˆä»å¯†æ–‡ä¸­å–å‡ºIVï¼Œç„¶åå¯¹å‰©ä¸‹çš„å¯†æ–‡åˆ†ç»„ï¼ˆ16æˆ–8å­—èŠ‚ä¸ºä¸€ç»„ï¼‰ ä½¿ç”¨ç§˜é’¥è§£å¯†ç¬¬ä¸€ç»„å¯†æ–‡ï¼Œå°†è§£å¯†ç»“æœä¸IVåšå¼‚æˆ–è¿ç®—ï¼Œå¾—åˆ°æ˜æ–‡1 ç„¶åä½¿ç”¨ç§˜é’¥è§£ç¬¬äºŒç»„å¯†æ–‡ï¼Œå°†è§£å¯†çš„ç»“æœä¸ä¸Šä¸€ç»„å¯†æ–‡è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œå¾—å‡ºæ˜æ–‡2 é‡å¤2-3ï¼Œç›´è‡³æ‰€æœ‰å¯†æ–‡è§£å¯†å®Œæ¯•  ä»¥ä¸Šå°±æ˜¯CBCæ¨¡å¼çš„åŠ å¯†è§£å¯†è¿‡ç¨‹ï¼Œæ¥ä¸‹æ¥è®²ä¸¤ç§æ‰‹æ®µï¼š
Padding Oracle Attack ç›´è¯‘ä¸º â€œå¡«å……Oracleæ”»å‡»â€ ï¼Œè¿™é‡Œä¸»è¦å…³æ³¨ä¸€ä¸‹è§£å¯†è¿‡ç¨‹ï¼š
å¯†æ–‡cipheré¦–å…ˆè¿›è¡Œä¸€ç³»åˆ—å¤„ç†ï¼Œå¦‚å›¾ä¸­çš„Block Cipher Decryption æˆ‘ä»¬å°†å¤„ç†åçš„å€¼ç§°ä¸º middle ä¸­é—´å€¼ ç„¶å middle ä¸æˆ‘ä»¬è¾“å…¥çš„ivè¿›è¡Œå¼‚æˆ–æ“ä½œ å¾—åˆ°çš„å³ä¸ºæ˜æ–‡ ä½†è¿™é‡Œæœ‰ä¸€ä¸ªè§„åˆ™å«åšPaddingå¡«å……ï¼š å› ä¸ºåŠ å¯†æ˜¯æŒ‰ç…§16ä½ä¸€ç»„åˆ†ç»„è¿›è¡Œçš„ è€Œå¦‚æœä¸è¶³16ä½ï¼Œå°±éœ€è¦è¿›è¡Œå¡«å……
æœ‰å‡ ä¸ªç©ºï¼Œå°±è¦å¡«å……å‡ ä¸ªâ€œå‡ â€
æ¯”å¦‚æ˜æ–‡ä¸ºadminï¼Œé‚£ä¹ˆéœ€è¦å¡«å……çš„å°±æ˜¯ admin\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b ï¼ˆ11ä¸ª\x0bï¼‰
å¦‚æœæˆ‘ä»¬è¾“å…¥ä¸€ä¸ªé”™è¯¯çš„ivï¼Œä¾æ—§æ˜¯å¯ä»¥è§£å¯†çš„ï¼Œä½†æ˜¯ middle å’Œæˆ‘ä»¬è¾“å…¥çš„ivç»è¿‡å¼‚æˆ–åå¾—åˆ°çš„å¡«å……å€¼å¯èƒ½å‡ºç°é”™è¯¯
æ¯”å¦‚æœ¬æ¥åº”è¯¥æ˜¯ admin\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b è€Œæˆ‘ä»¬é”™è¯¯çš„å¾—åˆ° admin\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x3b\x2c
è¿™æ ·è§£å¯†ç¨‹åºå¾€å¾€ä¼šæŠ›å‡ºå¼‚å¸¸(Padding Error)
åº”ç”¨åœ¨webé‡Œçš„æ—¶å€™ï¼Œå¾€å¾€æ˜¯302æˆ–æ˜¯500æŠ¥é”™ è€Œæ­£å¸¸è§£å¯†çš„æ—¶å€™æ˜¯200 æ‰€ä»¥è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æœåŠ¡å™¨çš„ååº”æ¥åˆ¤æ–­æˆ‘ä»¬è¾“å…¥çš„iv
çœ‹ä¾‹å­ï¼š
æˆ‘ä»¬å‡è®¾middleä¸­é—´å€¼ä¸ºï¼š
0x39 0x73 0x23 0x22 0x07 0x6a 0x26 0x3dæ­£ç¡®çš„è§£å¯†ivåº”è¯¥ä¸º'>
<meta property='og:url' content='https://anthem-whisper.github.io/p/padding-oracle-attackcbc%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/'>
<meta property='og:site_name' content='wh1sper'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' />
<meta name="twitter:title" content="Padding Oracle Attack&amp;CBCå­—èŠ‚ç¿»è½¬æ”»å‡»">
<meta name="twitter:description" content="å‰è¨€ åœ¨è¥¿å·¥å¤§ä¸¾åŠçš„NPUCTF2020ä¸Šé¢åšåˆ°ä¸€é“webcryptoçš„é¢˜ï¼Œä»¥å‰ä»æ¥æ²¡æ¥è§¦è¿‡å¯†ç å®‰å…¨æ–¹å‘ï¼Œè¿™æ¬¡æ­£å¥½å­¦ä¸€ä¸‹å…¥ä¸ªé—¨
æ­£æ–‡ å‚è€ƒ
Padding Oracle Attackï¼š
ã€Šç™½å¸½å­è®²webå®‰å…¨ã€‹P239
&amp;raquo;ä¸€å¶é£˜é›¶å¸ˆå‚…
CBCç¿»è½¬æ”»å‡»ï¼š
&amp;raquo;æŸå¸ˆå‚…
&amp;raquo;æŸæŸå¸ˆå‚…
å…ˆæ¥è®²ä¸€è®²CBCæ¨¡å¼åŠ å¯†åŸç†ï¼š
 é¦–å…ˆå°†æ˜æ–‡ï¼ˆPlaintextï¼‰åˆ†ç»„(å¸¸è§çš„ä»¥16æˆ–8å­—èŠ‚ä¸ºä¸€ç»„)ï¼Œä½æ•°ä¸è¶³çš„ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦å¡«å……ã€‚ ç”Ÿæˆä¸€ä¸ªéšæœºçš„åˆå§‹åŒ–å‘é‡(IV)å’Œä¸€ä¸ªå¯†é’¥ã€‚ å°†IVå’Œç¬¬ä¸€ç»„æ˜æ–‡å¼‚æˆ–ï¼ˆxorè¿ç®—ï¼‰ã€‚ ç”¨å¯†é’¥å¯¹3ä¸­xoråäº§ç”Ÿçš„å¯†æ–‡åŠ å¯†ã€‚ ç”¨4ä¸­äº§ç”Ÿçš„å¯†æ–‡å¯¹ç¬¬äºŒç»„æ˜æ–‡è¿›è¡Œxoræ“ä½œã€‚ ç”¨å¯†é’¥å¯¹5ä¸­äº§ç”Ÿçš„å¯†æ–‡åŠ å¯†ã€‚ é‡å¤4-7ï¼Œåˆ°æœ€åä¸€ç»„æ˜æ–‡ã€‚ å°†IVå’ŒåŠ å¯†åçš„å¯†æ–‡æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå¾—åˆ°æœ€ç»ˆçš„å¯†æ–‡  è§£å¯†è¿‡ç¨‹ï¼š
 å…ˆä»å¯†æ–‡ä¸­å–å‡ºIVï¼Œç„¶åå¯¹å‰©ä¸‹çš„å¯†æ–‡åˆ†ç»„ï¼ˆ16æˆ–8å­—èŠ‚ä¸ºä¸€ç»„ï¼‰ ä½¿ç”¨ç§˜é’¥è§£å¯†ç¬¬ä¸€ç»„å¯†æ–‡ï¼Œå°†è§£å¯†ç»“æœä¸IVåšå¼‚æˆ–è¿ç®—ï¼Œå¾—åˆ°æ˜æ–‡1 ç„¶åä½¿ç”¨ç§˜é’¥è§£ç¬¬äºŒç»„å¯†æ–‡ï¼Œå°†è§£å¯†çš„ç»“æœä¸ä¸Šä¸€ç»„å¯†æ–‡è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œå¾—å‡ºæ˜æ–‡2 é‡å¤2-3ï¼Œç›´è‡³æ‰€æœ‰å¯†æ–‡è§£å¯†å®Œæ¯•  ä»¥ä¸Šå°±æ˜¯CBCæ¨¡å¼çš„åŠ å¯†è§£å¯†è¿‡ç¨‹ï¼Œæ¥ä¸‹æ¥è®²ä¸¤ç§æ‰‹æ®µï¼š
Padding Oracle Attack ç›´è¯‘ä¸º â€œå¡«å……Oracleæ”»å‡»â€ ï¼Œè¿™é‡Œä¸»è¦å…³æ³¨ä¸€ä¸‹è§£å¯†è¿‡ç¨‹ï¼š
å¯†æ–‡cipheré¦–å…ˆè¿›è¡Œä¸€ç³»åˆ—å¤„ç†ï¼Œå¦‚å›¾ä¸­çš„Block Cipher Decryption æˆ‘ä»¬å°†å¤„ç†åçš„å€¼ç§°ä¸º middle ä¸­é—´å€¼ ç„¶å middle ä¸æˆ‘ä»¬è¾“å…¥çš„ivè¿›è¡Œå¼‚æˆ–æ“ä½œ å¾—åˆ°çš„å³ä¸ºæ˜æ–‡ ä½†è¿™é‡Œæœ‰ä¸€ä¸ªè§„åˆ™å«åšPaddingå¡«å……ï¼š å› ä¸ºåŠ å¯†æ˜¯æŒ‰ç…§16ä½ä¸€ç»„åˆ†ç»„è¿›è¡Œçš„ è€Œå¦‚æœä¸è¶³16ä½ï¼Œå°±éœ€è¦è¿›è¡Œå¡«å……
æœ‰å‡ ä¸ªç©ºï¼Œå°±è¦å¡«å……å‡ ä¸ªâ€œå‡ â€
æ¯”å¦‚æ˜æ–‡ä¸ºadminï¼Œé‚£ä¹ˆéœ€è¦å¡«å……çš„å°±æ˜¯ admin\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b ï¼ˆ11ä¸ª\x0bï¼‰
å¦‚æœæˆ‘ä»¬è¾“å…¥ä¸€ä¸ªé”™è¯¯çš„ivï¼Œä¾æ—§æ˜¯å¯ä»¥è§£å¯†çš„ï¼Œä½†æ˜¯ middle å’Œæˆ‘ä»¬è¾“å…¥çš„ivç»è¿‡å¼‚æˆ–åå¾—åˆ°çš„å¡«å……å€¼å¯èƒ½å‡ºç°é”™è¯¯
æ¯”å¦‚æœ¬æ¥åº”è¯¥æ˜¯ admin\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b è€Œæˆ‘ä»¬é”™è¯¯çš„å¾—åˆ° admin\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x3b\x2c
è¿™æ ·è§£å¯†ç¨‹åºå¾€å¾€ä¼šæŠ›å‡ºå¼‚å¸¸(Padding Error)
åº”ç”¨åœ¨webé‡Œçš„æ—¶å€™ï¼Œå¾€å¾€æ˜¯302æˆ–æ˜¯500æŠ¥é”™ è€Œæ­£å¸¸è§£å¯†çš„æ—¶å€™æ˜¯200 æ‰€ä»¥è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æœåŠ¡å™¨çš„ååº”æ¥åˆ¤æ–­æˆ‘ä»¬è¾“å…¥çš„iv
çœ‹ä¾‹å­ï¼š
æˆ‘ä»¬å‡è®¾middleä¸­é—´å€¼ä¸ºï¼š
0x39 0x73 0x23 0x22 0x07 0x6a 0x26 0x3dæ­£ç¡®çš„è§£å¯†ivåº”è¯¥ä¸º">
    </head>
    <body class="">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.body.dataset.scheme = 'dark';
        } else {
            document.body.dataset.scheme = 'light';
        }
    })();
</script><div class="container main-container flex on-phone--column extended article-page with-toolbar">
            <aside class="sidebar left-sidebar sticky">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header class="site-info">
        
            <figure class="site-avatar">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu493b2ad2ace11203a689e4edf1306ab0_73291_300x0_resize_box_2.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                

                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
        
        <h1 class="site-name"><a href="https://anthem-whisper.github.io/">wh1sper</a></h1>
        <h2 class="site-description">ä¸“æ³¨Webå®‰å…¨å’Œä»£ç å®¡è®¡</h2>
    </header>

    <ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/about'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='/'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search'>
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        
            <li id="dark-mode-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <span>Dark Mode</span>
            </li>
        
    </ol>
</aside>

            <main class="main full-width">
    <div id="article-toolbar">
        <a href="https://anthem-whisper.github.io/" class="back-home">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



            <span>Back</span>
        </a>
    </div>

    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <h2 class="article-title">
        <a href="/p/padding-oracle-attackcbc%E5%AD%97%E8%8A%82%E7%BF%BB%E8%BD%AC%E6%94%BB%E5%87%BB/">Padding Oracle Attack&amp;CBCå­—èŠ‚ç¿»è½¬æ”»å‡»</a>
    </h2>

    </div>
</header>

    <section class="article-content">
    <h3 id="å‰è¨€"><strong>å‰è¨€</strong></h3>
<p>åœ¨è¥¿å·¥å¤§ä¸¾åŠçš„NPUCTF2020ä¸Šé¢åšåˆ°ä¸€é“webcryptoçš„é¢˜ï¼Œä»¥å‰ä»æ¥æ²¡æ¥è§¦è¿‡å¯†ç å®‰å…¨æ–¹å‘ï¼Œè¿™æ¬¡æ­£å¥½å­¦ä¸€ä¸‹å…¥ä¸ªé—¨</p>
<h3 id="æ­£æ–‡"><strong>æ­£æ–‡</strong></h3>
<p>å‚è€ƒ</p>
<p>Padding Oracle Attackï¼š</p>
<p>ã€Šç™½å¸½å­è®²webå®‰å…¨ã€‹P239</p>
<p><a class="link" href="https://skysec.top/2017/12/13/padding-oracle%e5%92%8ccbc%e7%bf%bb%e8%bd%ac%e6%94%bb%e5%87%bb/"  target="_blank" rel="noopener"
    >&raquo;ä¸€å¶é£˜é›¶å¸ˆå‚…</a></p>
<p>CBCç¿»è½¬æ”»å‡»ï¼š</p>
<p><a class="link" href="https://www.jianshu.com/p/7f171477a603"  target="_blank" rel="noopener"
    >&raquo;æŸå¸ˆå‚…</a></p>
<p><a class="link" href="https://blog.csdn.net/include_heqile/article/details/79942993"  target="_blank" rel="noopener"
    >&raquo;æŸæŸå¸ˆå‚…</a></p>
<p>å…ˆæ¥è®²ä¸€è®²CBCæ¨¡å¼åŠ å¯†åŸç†ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210120170001.png" alt="img"  /></p>
<ol>
<li>é¦–å…ˆå°†æ˜æ–‡ï¼ˆPlaintextï¼‰åˆ†ç»„(å¸¸è§çš„ä»¥16æˆ–8å­—èŠ‚ä¸ºä¸€ç»„)ï¼Œä½æ•°ä¸è¶³çš„ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦å¡«å……ã€‚</li>
<li>ç”Ÿæˆä¸€ä¸ªéšæœºçš„åˆå§‹åŒ–å‘é‡(IV)å’Œä¸€ä¸ªå¯†é’¥ã€‚</li>
<li>å°†IVå’Œç¬¬ä¸€ç»„æ˜æ–‡å¼‚æˆ–ï¼ˆxorè¿ç®—ï¼‰ã€‚</li>
<li>ç”¨å¯†é’¥å¯¹3ä¸­xoråäº§ç”Ÿçš„å¯†æ–‡åŠ å¯†ã€‚</li>
<li>ç”¨4ä¸­äº§ç”Ÿçš„å¯†æ–‡å¯¹ç¬¬äºŒç»„æ˜æ–‡è¿›è¡Œxoræ“ä½œã€‚</li>
<li>ç”¨å¯†é’¥å¯¹5ä¸­äº§ç”Ÿçš„å¯†æ–‡åŠ å¯†ã€‚</li>
<li>é‡å¤4-7ï¼Œåˆ°æœ€åä¸€ç»„æ˜æ–‡ã€‚</li>
<li>å°†IVå’ŒåŠ å¯†åçš„å¯†æ–‡æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå¾—åˆ°æœ€ç»ˆçš„å¯†æ–‡</li>
</ol>
<p>è§£å¯†è¿‡ç¨‹ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210120170010.png" alt="img"  /></p>
<ol>
<li>å…ˆä»å¯†æ–‡ä¸­å–å‡ºIVï¼Œç„¶åå¯¹å‰©ä¸‹çš„å¯†æ–‡åˆ†ç»„ï¼ˆ16æˆ–8å­—èŠ‚ä¸ºä¸€ç»„ï¼‰</li>
<li>ä½¿ç”¨ç§˜é’¥è§£å¯†ç¬¬ä¸€ç»„å¯†æ–‡ï¼Œå°†è§£å¯†ç»“æœä¸IVåšå¼‚æˆ–è¿ç®—ï¼Œå¾—åˆ°æ˜æ–‡1</li>
<li>ç„¶åä½¿ç”¨ç§˜é’¥è§£ç¬¬äºŒç»„å¯†æ–‡ï¼Œå°†è§£å¯†çš„ç»“æœä¸ä¸Šä¸€ç»„å¯†æ–‡è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œå¾—å‡ºæ˜æ–‡2</li>
<li>é‡å¤2-3ï¼Œç›´è‡³æ‰€æœ‰å¯†æ–‡è§£å¯†å®Œæ¯•</li>
</ol>
<p>ä»¥ä¸Šå°±æ˜¯CBCæ¨¡å¼çš„åŠ å¯†è§£å¯†è¿‡ç¨‹ï¼Œæ¥ä¸‹æ¥è®²ä¸¤ç§æ‰‹æ®µï¼š</p>
<h4 id="padding-oracle-attack"><strong>Padding Oracle Attack</strong></h4>
<p>ç›´è¯‘ä¸º â€œå¡«å……Oracleæ”»å‡»â€ ï¼Œè¿™é‡Œä¸»è¦å…³æ³¨ä¸€ä¸‹è§£å¯†è¿‡ç¨‹ï¼š</p>
<p>å¯†æ–‡cipheré¦–å…ˆè¿›è¡Œä¸€ç³»åˆ—å¤„ç†ï¼Œå¦‚å›¾ä¸­çš„Block Cipher Decryption
æˆ‘ä»¬å°†å¤„ç†åçš„å€¼ç§°ä¸º <code>middle</code> ä¸­é—´å€¼
ç„¶å <code>middle</code> ä¸æˆ‘ä»¬è¾“å…¥çš„ivè¿›è¡Œå¼‚æˆ–æ“ä½œ
å¾—åˆ°çš„å³ä¸ºæ˜æ–‡
ä½†è¿™é‡Œæœ‰ä¸€ä¸ªè§„åˆ™å«åšPaddingå¡«å……ï¼š
å› ä¸ºåŠ å¯†æ˜¯æŒ‰ç…§16ä½ä¸€ç»„åˆ†ç»„è¿›è¡Œçš„
è€Œå¦‚æœä¸è¶³16ä½ï¼Œå°±éœ€è¦è¿›è¡Œå¡«å……</p>
<p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210120170017.png" alt="img"  /></p>
<p>æœ‰å‡ ä¸ªç©ºï¼Œå°±è¦å¡«å……å‡ ä¸ªâ€œå‡ â€</p>
<p>æ¯”å¦‚æ˜æ–‡ä¸ºadminï¼Œé‚£ä¹ˆéœ€è¦å¡«å……çš„å°±æ˜¯ <code>admin\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b</code> ï¼ˆ11ä¸ª\x0bï¼‰</p>
<p>å¦‚æœæˆ‘ä»¬è¾“å…¥ä¸€ä¸ªé”™è¯¯çš„ivï¼Œä¾æ—§æ˜¯å¯ä»¥è§£å¯†çš„ï¼Œä½†æ˜¯ <code>middle</code> å’Œæˆ‘ä»¬è¾“å…¥çš„ivç»è¿‡å¼‚æˆ–åå¾—åˆ°çš„å¡«å……å€¼å¯èƒ½å‡ºç°é”™è¯¯</p>
<p>æ¯”å¦‚æœ¬æ¥åº”è¯¥æ˜¯ <code>admin\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b</code>
è€Œæˆ‘ä»¬é”™è¯¯çš„å¾—åˆ° <code>admin\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x3b\x2c</code></p>
<p>è¿™æ ·è§£å¯†ç¨‹åºå¾€å¾€ä¼šæŠ›å‡ºå¼‚å¸¸(Padding Error)</p>
<p>åº”ç”¨åœ¨webé‡Œçš„æ—¶å€™ï¼Œå¾€å¾€æ˜¯302æˆ–æ˜¯500æŠ¥é”™
è€Œæ­£å¸¸è§£å¯†çš„æ—¶å€™æ˜¯200
æ‰€ä»¥è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æœåŠ¡å™¨çš„ååº”æ¥åˆ¤æ–­æˆ‘ä»¬è¾“å…¥çš„iv</p>
<p>çœ‹ä¾‹å­ï¼š</p>
<p>æˆ‘ä»¬å‡è®¾middleä¸­é—´å€¼ä¸ºï¼š</p>
<pre><code>0x39 0x73 0x23 0x22 0x07 0x6a 0x26 0x3d
</code></pre><p>æ­£ç¡®çš„è§£å¯†ivåº”è¯¥ä¸º</p>
<pre><code>0x6d 0x36 0x70 0x76 0x03 0x6e 0x22 0x39
</code></pre><p>è§£å¯†åæ­£ç¡®çš„æ˜æ–‡ä¸ºï¼š</p>
<pre><code>T E S T 0x04 0x04 0x04 0x04
</code></pre><p>ä½†æ˜¯å…³é”®ç‚¹åœ¨äºï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ivçš„å€¼ï¼Œå´ä¸èƒ½å¾—åˆ°ä¸­é—´å€¼å’Œè§£å¯†åæ˜æ–‡çš„å€¼
è€Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯<strong>åªæ ¹æ®æˆ‘ä»¬è¾“å…¥çš„ivå€¼å’ŒæœåŠ¡å™¨çš„çŠ¶æ€å»åˆ¤æ–­å‡ºè§£å¯†åæ˜æ–‡çš„å€¼</strong>
è¿™é‡Œçš„æ”»å‡»å³å«åš <code>Padding Oracle Attack</code> æ”»å‡»
è¿™æ—¶å€™æˆ‘ä»¬é€‰æ‹©è¿›è¡Œçˆ†ç ´æ”»å‡»</p>
<p>å¦‚æœæˆ‘ä»¬æ„é€ ä¸€ä¸ªivä¸ºï¼š</p>
<pre><code>0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
</code></pre><p>é‚£ä¹ˆ <code>middle</code> çš„å€¼å’Œè¿™ä¸ªivå¼‚æˆ–å°†ä¼šå¾—åˆ°åŸå°ä¸åŠ¨çš„ <code>middle</code> çš„å€¼</p>
<pre><code>0x39 0x73 0x23 0x22 0x07 0x6a 0x26 0x3d
</code></pre><p>ç°åœ¨è¿™ä¸ªè§£å¯†ç»“æœæ˜¯ä¸å¯¹çš„</p>
<p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210120170100.png" alt="img"  /></p>
<p>æ­£ç¡®çš„ <code>padding</code> å€¼åªå¯èƒ½æ˜¯ï¼š</p>
<ul>
<li>1ä¸ªå­—èŠ‚çš„paddingä¸º0x01</li>
<li>2ä¸ªå­—èŠ‚çš„paddingä¸º0x02ï¼Œ0x02</li>
<li>3ä¸ªå­—èŠ‚çš„paddingä¸º0x03ï¼Œ0x03ï¼Œ0x03</li>
<li>4ä¸ªå­—èŠ‚çš„paddingä¸º0x04ï¼Œ0x04ï¼Œ0x04ï¼Œ0x04</li>
<li>â€¦â€¦</li>
</ul>
<p>å› æ­¤æˆ‘ä»¬å¸Œæœ›æ…¢æ…¢è°ƒæ•´ivçš„å€¼ï¼Œå¹¶ä¸”å¸Œæœ›è§£å¯†åæœ€åä¸€ä¸ªå€¼ä¸ºæ­£ç¡®çš„ <code>padding</code> æ¯”å¦‚ä¸€ä¸ª0x01ï¼Œæˆ‘ä»¬äºæ˜¯éå†æœ€åä¸€ä½ivï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210120170112.png" alt="img"  /></p>
<p>é‚£ä¹ˆæœ€åä¸€ä½ä¸­é—´å¯†æ–‡å°±æ˜¯ï¼š <code>0x01^0x3C=0x3D</code> ï¼ˆè¿™ä¸ªä¸€å®šæˆç«‹ï¼Œçœ‹å›¾ï¼‰,åŸæ¥çš„æ˜æ–‡å°±æ˜¯ <code>0x3D^0x0F=0x32</code>ï¼ˆä¸­é—´å¯†æ–‡^åŸæ¥çš„ivï¼‰</p>
<p>çŸ¥é“äº†æœ€åä¸€ä½çš„ä¸­é—´å¯†æ–‡ï¼Œå°±å¯ä»¥éå†å€’æ•°ç¬¬äºŒä½iväº†ï¼Œè¿™ä¸ªæ—¶å€™åº”è¯¥ä¸º <code>0x02</code> è€Œé <code>0x01</code> äº†ã€‚çœ‹å›¾å°±æ‡‚ï¼š</p>
<p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210120170121.png" alt="img"  /></p>
<p>ä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°±èƒ½æ¨ç®—æ‰€æœ‰ä¸­é—´å¯†æ–‡ï¼Œå†ç”¨ <code>ä¸­é—´å¯†æ–‡^åŸæ¥çš„iv</code> å°±èƒ½ç®—å‡ºæ˜æ–‡äº†</p>
<h4 id="cbcå­—èŠ‚ç¿»è½¬æ”»å‡»"><strong>CBCå­—èŠ‚ç¿»è½¬æ”»å‡»</strong></h4>
<p>æœ‰äº†ä¸Šé¢çš„CBCåŠ å¯†è§£å¯†è¿‡ç¨‹çš„åŸºç¡€ï¼Œè¿™ä¸ªæ‰‹æ®µå…¶å®å¾ˆå®¹æ˜“ç†è§£ï¼›</p>
<p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210120170128.png" alt="img"  /></p>
<p>ç”±è§£å¯†ç®—æ³•å¯çŸ¥ï¼š</p>
<pre><code>A=B^C
</code></pre><p>ç”± <code>^</code> è¿ç®—çš„æ€§è´¨æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼š</p>
<pre><code>A=B^Cã€B=A^Cã€C=A^B
</code></pre><p>è¿™æ˜¯æœ€å…³é”®çš„ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æ¨å¯¼å‡ºä¸‰è€…åšå¼‚æˆ–è¿ç®—çš„ç»“æœæ˜¯0</p>
<pre><code>C=A^B
C^C=A^B^C=0
</code></pre><p>æˆ‘ä»¬ä¿®æ”¹äº†Bçš„å€¼ï¼Œå°±ä¸€å®šä¼šå½±å“åˆ°A</p>
<pre><code>B^X^C=A^X
</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªè¦ç»™Bå¼‚æˆ–äº†Xï¼ŒAçš„å€¼ä¹Ÿä¼šæ”¹å˜ä¸ºä»–ä¹‹å‰çš„å€¼å¼‚æˆ–Xçš„ç»“æœ</p>
<h4 id="ä¸€-é“ctfçš„ä¾‹å­"><strong>ä¸€ é“CTFçš„ä¾‹å­</strong></h4>
<p>NPUCTF2020_webğŸ•</p>
<pre><code>æˆ‘æ‘Šç‰Œäº†ï¼Œå°±æ˜¯æ‡’å¾—å†™å‰ç«¯
&lt;?php 
error_reporting(0);
include('config.php');   # $key,********$file1*********
define(&quot;METHOD&quot;, &quot;aes-128-cbc&quot;);  //å®šä¹‰åŠ å¯†æ–¹å¼
define(&quot;SECRET_KEY&quot;, $key);    //å®šä¹‰å¯†é’¥
define(&quot;IV&quot;,&quot;6666666666666666&quot;);    //å®šä¹‰åˆå§‹å‘é‡ 16ä¸ª6
define(&quot;BR&quot;,'&lt;br&gt;');
if(!isset($_GET['source']))header('location:./index.php?source=1');


#var_dump($GLOBALS);   //å¬è¯´ä½ æƒ³çœ‹è¿™ä¸ªï¼Ÿ
function aes_encrypt($iv,$data)
{
    echo &quot;--------encrypt---------&quot;.BR;
    echo 'IV:'.$iv.BR;
    return base64_encode(openssl_encrypt($data, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv)).BR;
}
function aes_decrypt($iv,$data)
{
    return openssl_decrypt(base64_decode($data),METHOD,SECRET_KEY,OPENSSL_RAW_DATA,$iv) or die('False');  #ä¸è¿”å›å¯†æ–‡ï¼Œè§£å¯†æˆåŠŸè¿”å›1ï¼Œè§£å¯†å¤±è´¥è¿”å›False
}
if($_GET['method']=='encrypt')
{
    $iv = IV;
    $data = $file1;    
    echo aes_encrypt($iv,$data);
} else if($_GET['method']==&quot;decrypt&quot;)
{
    $iv = @$_POST['iv'];
    $data = @$_POST['data'];
    echo aes_decrypt($iv,$data);
}
echo &quot;æˆ‘æ‘Šç‰Œäº†ï¼Œå°±æ˜¯æ‡’å¾—å†™å‰ç«¯&quot;.BR;

if($_GET['source']==1)highlight_file(__FILE__);
?&gt;
</code></pre><p>padding Oracle Attack</p>
<p>expï¼š</p>
<pre><code># coding:utf-8
import requests
import base64

# b'\x97.\xda\xb8\xa5P\t\x95\xae\x9b\xf5\xbf\xe2\x8b.&lt;'
CYPHERTEXT = base64.b64decode(&quot;ly7auKVQCZWum/W/4osuPA==&quot;)
# initialization vector
IV = &quot;6666666666666666&quot;
# PKCS7 16ä¸ªå­—èŠ‚ä¸º1ç»„
N = 16
# intermediaryValue ^ IV = plainText
inermediaryValue = &quot;&quot;
plainText = &quot;&quot;
# çˆ†ç ´æ—¶ä¸æ–­éœ€è¦æ›´æ”¹çš„iv
iv = &quot;&quot;
URL = &quot;http://webdog.popscat.top/index.php?method=decrypt&amp;source=1&quot;


def xor(a, b):
    &quot;&quot;&quot;
    ç”¨äºè¾“å‡ºä¸¤ä¸ªå­—ç¬¦ä¸²å¯¹ä½å¼‚æˆ–çš„ç»“æœ
    &quot;&quot;&quot;
    return &quot;&quot;.join([chr(ord(a[i]) ^ ord(b[i])) for i in range(len(a))])


for step in range(1, N + 1):
    padding = chr(step) * (step - 1)
    print(step,end=&quot;,&quot;)
    for i in range(0, 256):
        print(i)
        &quot;&quot;&quot;
        ivç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š
            å¾…çˆ†ç ´ä½ç½® chr(0)*(N-step) 
            æ­£åœ¨çˆ†ç ´ä½ç½® chr(i) 
            ä½¿ iv[N-step+1:] ^ inermediaryValue = padding çš„ xor(padding,inermediaryValue)
        &quot;&quot;&quot;
        iv = chr(0)*(N-step)+chr(i)+xor(padding,inermediaryValue)
        data = {
            &quot;data&quot;: &quot;ly7auKVQCZWum/W/4osuPA==&quot;,
            &quot;iv&quot;: iv
        }
        r = requests.post(URL,data = data)
        if r.text !=&quot;False&quot;:
            inermediaryValue = xor(chr(i),chr(step)) + inermediaryValue
            print(inermediaryValue)
            break
plainText = xor(inermediaryValue,IV)
print(plainText)
</code></pre><p>è¿è¡Œï¼Œå¾—åˆ° <code>FlagIsHere.php</code> è®¿é—®ä¹‹ï¼Œå¾—åˆ°å¦‚ä¸‹æºç ï¼š</p>
<pre><code>F7LMTk/3nKSVUoSQuOS/dA==
&lt;?php 
#error_reporting(0);
include('config.php');    //**************$file2********last step!!
define(&quot;METHOD&quot;, &quot;aes-128-cbc&quot;);
define(&quot;SECRET_KEY&quot;, &quot;6666666&quot;);
session_start();

function get_iv(){    //ç”Ÿæˆéšæœºåˆå§‹å‘é‡IV
    $random_iv='';
    for($i=0;$i&lt;16;$i++){
        $random_iv.=chr(rand(1,255));
    }
    return $random_iv;
}

$lalala = 'piapiapiapia';

if(!isset($_SESSION['Identity'])){
    $_SESSION['iv'] = get_iv();

    $_SESSION['Identity'] = base64_encode(openssl_encrypt($lalala, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $_SESSION['iv']));
}
echo base64_encode($_SESSION['iv']).&quot;&lt;br&gt;&quot;;

if(isset($_POST['iv'])){
    $tmp_id = openssl_decrypt(base64_decode($_SESSION['Identity']), METHOD, SECRET_KEY, OPENSSL_RAW_DATA, base64_decode($_POST['iv']));
    echo $tmp_id.&quot;&lt;br&gt;&quot;;
    if($tmp_id ==='weber')die($file2);
}

highlight_file(__FILE__);
?&gt;
</code></pre><p>æ•´ç†ä¸€ä¸‹å·²çŸ¥ä¿¡æ¯ï¼š</p>
<pre><code>iv=
F7LMTk/3nKSVUoSQuOS/dA==
\x17 \xb2 \xcc \x4e \x4f \xf7 \x9c \xa4 \x95 \x52 \x84 \x90 \xb8 \xe4 \xbf \x74 
åŠ å¯†åï¼š
$Identity='MLvuYeH07rhiAa5NJ1p75A=='
$Identity='\x30 \xbb \xee \x61 \xe1 \xf4 \xee \xb8 \x62 \x01 \xae \x4d \x27 \x5a \x7b \xe4 '
</code></pre><p>ç›®çš„å°±æ˜¯ä¼ å…¥æ–°çš„ivå¯¹identityè¿›è¡Œè§£å¯†ï¼Œå¦‚æœè§£å¯†ç»“æœä¸º&rsquo;weber&rsquo;é‚£ä¹ˆå°±çˆ½æ­ªæ­ªï¼Œè¿™é‡Œè€ƒå¯Ÿçš„å°±æ˜¯CBCå­—èŠ‚ç¿»è½¬æ”»å‡»</p>
<p>å’ŒPadding Oracle Attackä¸ä¸€æ ·ï¼Œè¿™é‡Œä¸éœ€è¦æ¨æµ‹ä¸­é—´å¯†æ–‡ï¼Œæ ¹æ®æˆ‘ä¸Šé¢è¯´çš„</p>
<pre><code>B^X^C=A^X
</code></pre><p>æœ¬æ¥æ˜¯ <code>piapiapiapia\x04\x04\x04\x04</code> ç°åœ¨æˆ‘ä»¬éœ€è¦æ”¹ä¸º <code>weber\x0B\x0B\x0B\x0B\x0B\x0B\x0B\x0B\x0B\x0B\x0B</code> ï¼Œå°±æ‹¿ç¬¬ä¸€ä½æ¥è¯´ï¼š</p>
<p>æˆ‘ä»¬æƒ³è¦æŠŠ <code>p</code> æ”¹ä¸º <code>w</code> ï¼Œé‚£ä¹ˆæˆ‘å°±è¦æ‰¾å‡º <code>X</code> çš„å€¼ï¼Œ <code>'p'^X='w'</code> å¾ˆå®¹æ˜“ç®—å‡º <code>X='p'^'w'</code> é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦åœ¨å°†Bå¼‚æˆ–ä¸€ä¸ª <code>('p'^'w')</code> ï¼Œå°±å¯ä»¥è¾¾åˆ°ç›®çš„ã€‚</p>
<p>ä¸è¿‡å½“æ—¶æ¯”èµ›çš„æ—¶å€™å¹³å°è¢«Däº†ï¼Œæˆ‘æ˜¯åœ¨å‡ºé¢˜äººçš„å­¦ç”Ÿæœºä¸Šé¢è·‘ï¼Œè„šæœ¬åº”è¯¥æ²¡é—®é¢˜ï¼Œä½†æ˜¯è·‘ä¸å‡ºæ¥ï¼Œæ¢äº†æ­£å¸¸ç¯å¢ƒivåˆä¸ä¸€æ ·æ‡’å¾—é‡å†™ï¼Œæ‰€ä»¥ç”¨äº†å­¦é•¿çš„è„šæœ¬ï¼š</p>
<pre><code>import base64
def bxor(b1, b2): # use xor for bytes
    parts = []
    for b1, b2 in zip(b1, b2):
        parts.append(bytes([b1 ^ b2]))
    return b''.join(parts)
iv = base64.b64decode(&quot;h34HL5RbMPw8oTaQ+P58nw==&quot;)
text = b&quot;piapiapiapia\x04\x04\x04\x04&quot;
result = b&quot;weber\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b\x0b&quot;
middle = bxor(iv,text)
iv = bxor(middle,result)
print(base64.b64encode(iv))
</code></pre><p>è·‘å‡ºæ¥POSTä¸€ä¸ªivè¿‡å»å¾—åˆ°ä¸€ä¸ªç½‘å€ï¼š <code>https://c-t.work/s/034d3b3bf3fb48||verification code:2q2hwm</code></p>
<p>å¥½åƒæ˜¯æœ‰ä¸ªé™„ä»¶ï¼Œä¸‹è½½æ¥æ˜¯ä¸€ä¸ªxxx.classæ–‡ä»¶è€ƒçš„Javaåç¼–è¯‘ã€‚ã€‚ã€‚ä¸è¿‡ç™¾åº¦èƒ½æœåˆ°ï¼Œç”¨å·¥å…· <code>jd-gui-1.4.0</code> ä¸€ä¸‹å°±è·‘å‡ºæ¥ã€‚</p>
<p>å¾—åˆ°æ•°ç»„ï¼Œå°±æ˜¯flagçš„ASCIIç </p>
<p><img src="https://cdn.jsdelivr.net/gh/Anthem-whisper/imgbed@main/img/20210120170140.png" alt="img"  /></p>
<pre><code>q = [102, 108, 97, 103, 123, 119, 101, 54, 95, 52, 111, 103, 
     95, 49, 115, 95, 101, 52, 115, 121, 103, 48, 105, 110, 103, 125]
for i in q:
    print(chr(i), end='')
</code></pre><p>flag{we6_4og_1s_e4syg0ing}</p>

</section>


    <footer class="article-footer">
    

    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>

    
</article>

    <aside class="related-contents--wrapper">
    
    
</aside>


    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (DISQUS) {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2021 wh1sper
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="2.2.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >
            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
